## Post #1
- Username: Russian
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Wed Dec 28, 2005 7:29 pm
- Post datetime: 2005-12-28T11:34:03+00:00
- Post Title: Guild Wars .DAT File

Hallo, I got Guild Wars and its all packed in a GW.dat file (over 2 GB).
Does anyone know how to extract or open the .dat file. Cause there is music in it and I want to replace it with some other music.
Tnx,
Russian
## Post #2
- Username: friendsofwatto
- Rank: VVIP member
- Number of posts: 532
- Joined date: Wed Jun 30, 2004 10:01 pm
- Post datetime: 2005-12-28T12:33:21+00:00
- Post Title: Guild Wars .DAT File

Hi mate,

This is where we have been working on the format - [http://wiki.xentax.com/index.php/Guild_Wars_DAT](http://wiki.xentax.com/index.php/Guild_Wars_DAT) - but I don't think we have anything working yet. Sorry mate.

WATTO
[watto@watto.org](mailto:watto@watto.org)
[http://www.watto.org](http://www.watto.org)
## Post #3
- Username: Russian
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Wed Dec 28, 2005 7:29 pm
- Post datetime: 2005-12-29T12:04:43+00:00
- Post Title: Guild Wars .DAT File

TNX, but I have already checked that out and dont understand it lol.
Maybe u can help me by saying with what packer its packed or somethin..
Tnx, 
Russian
## Post #4
- Username: friendsofwatto
- Rank: VVIP member
- Number of posts: 532
- Joined date: Wed Jun 30, 2004 10:01 pm
- Post datetime: 2005-12-29T12:41:02+00:00
- Post Title: Guild Wars .DAT File

We do not know any programs or packers for this game yet.

WATTO
[watto@watto.org](mailto:watto@watto.org)
[http://www.watto.org](http://www.watto.org)
## Post #5
- Username: Russian
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Wed Dec 28, 2005 7:29 pm
- Post datetime: 2005-12-29T12:54:17+00:00
- Post Title: Guild Wars .DAT File

Lets try to find one ...?
## Post #6
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2005-12-31T06:22:23+00:00
- Post Title: Guild Wars .DAT File

Be our guest, if you find one, let us know!
## Post #7
- Username: MtnSyn
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Thu Feb 09, 2006 9:18 pm
- Post datetime: 2006-02-09T13:29:48+00:00
- Post Title: Guild Wars .DAT File

found this site via google, and really hope you guys could get this workin. I've read all the stuff about the gw.dat file from the wiki and looks complicated lol.  

I'm kinda concerned what all is in that file especially considering there is "dye" in the game that allows you to change the color of Armor/Weapons.. would each color be a diffrent picture image... resulting in 50+ pictures for a single item... or would there only be one file but the game tells it to shade it a certain color of blue/red/green etc...?

great app btw, tried it on a couple half-life .wad files and worked perfectly.
## Post #8
- Username: Bane
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Sun Feb 12, 2006 4:23 am
- Post datetime: 2006-02-11T20:27:27+00:00
- Post Title: Guild Wars .DAT File

Hi guys,

I also found this post via google.  I was hoping to find a unpacking program for the gw.dat, I assume its where the music/sounds files are stored along with other thing, but mostly I'm interested in the sound files.
## Post #9
- Username: Xuerian
- Rank: ultra-n00b
- Number of posts: 4
- Joined date: Tue Feb 14, 2006 12:51 am
- Post datetime: 2006-02-13T17:16:28+00:00
- Post Title: Guild Wars .DAT File

I've read over the [wiki page](http://wiki.xentax.com/index.php/Guild_Wars_DAT) and the [comments page](http://wiki.xentax.com/index.php/Talk:Guild_Wars_DAT), and the Train Driver 2005 fiasco [thread](http://forum.xentax.com/viewtopic.php?t=1621&highlight=guild+wars) ...  It doesn't really look like there is no solution yet, but more that no one has brought together the separate work that people got done in discussion (Or finished documenting it, or releasing their stuff... I couldn't find contact information for the interesting ones) [here.](http://wiki.xentax.com/index.php/Talk:Guild_Wars_DAT) 

So what it looks like is that in/here at XeNTaX, music (From the raw DAT) and many other files (Through DLL hooking) have been successfully extracted (I tried finding the LAME header, but... gah, I've got a leeooonnng way to go, I don't even fully understand how to understand the data presented in a hex editor, or if I'm missing a stage, or.. etc), but not the complete filesystem as was bragged upon in the [thread](http://forum.xentax.com/viewtopic.php?t=1621&highlight=guild+wars) ... 

It would be really neat if someone who knows the people in the discussion could tag them and get them to post everything they have (Not necessarily work on it more.. Just so everyone else is up to speed).
## Post #10
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2006-02-14T08:38:51+00:00
- Post Title: Guild Wars .DAT File

I agree, and actually the wiki would be the place to collect all this info.
## Post #11
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2006-02-15T15:05:30+00:00
- Post Title: Guild Wars .DAT File

If you would like a list of the people who have contributed to the WIKI page, you can always click on 'Page history' when viewing it... It should be either in the left-hand navigation bar or along the top of the page (or  both).
## Post #12
- Username: Xuerian
- Rank: ultra-n00b
- Number of posts: 4
- Joined date: Tue Feb 14, 2006 12:51 am
- Post datetime: 2006-02-19T03:51:47+00:00
- Post Title: Guild Wars .DAT File

MrMouse: Right.... It's all there, nothing new here...  

Dinoguy: Yeah, that's the general idea... Don't know what I'm looking for [here](http://wiki.xentax.com/index.php?title=Talk:Guild_Wars_DAT&action=history&limit=500&offset=0), though...   

The key people in the discussion page all either have no userpage or no relevant info on it... So I can't do the legwork contacting them without being a human forum-spider and getting lucky finding something here on the forums, unless there's something obvious I missed. If there is, point it out if you would so I can start.
## Post #13
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2006-02-20T01:58:32+00:00
- Post Title: Guild Wars .DAT File

> Reply from Xuerian
>
> Dinoguy: Yeah, that's the general idea... Don't know what I'm looking for here, though...
Hmm... I seem to have forgotten that the page has been moved a time or two... even through [this page](http://wiki.xentax.com/index.php?title=Guild_Wars_DAT&action=history&limit=500&offset=0), the only contributer is shown to be Mr.Mouse...
## Post #14
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2006-02-20T07:53:27+00:00
- Post Title: Guild Wars .DAT File

Well, yes, for that page. But the content was I think done by this mix of people: 

[http://wiki.xentax.com/index.php/Talk:Guild_Wars_DAT](http://wiki.xentax.com/index.php/Talk:Guild_Wars_DAT)
## Post #15
- Username: Xuerian
- Rank: ultra-n00b
- Number of posts: 4
- Joined date: Tue Feb 14, 2006 12:51 am
- Post datetime: 2006-02-20T17:20:46+00:00
- Post Title: Guild Wars .DAT File

Alright. So the history pages (Both talk and base) only have Mouse's pawprints.

As for the talk page, these four seem to have done most of the work, and have gotten the furthest... But no user pages (But nick, which has nothing but questions). 
-SilentAvenger (Ringleader!)
-Republicola
-[Nicoli_s](http://wiki.xentax.com/index.php/User:Nicoli_s)
-xttocs

I didn't find any forum profiles for them either, so I subsequently can't try to contact them that way.... The only lead I can find is the IRC channel ( irc.wc3campagins.com #hakhak ) that AzuiSleet mentions at the bottom, but I don't have a working IRC client t the time, I'll need to spend a few minutes and look into that.... So for now just a restatement of the obvious.
## Post #16
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2006-02-21T02:14:37+00:00
- Post Title: 

I'm fairly certain that at least the first three posted here a few times, but I'm not sure if they did so as guests or what.
## Post #17
- Username: Xuerian
- Rank: ultra-n00b
- Number of posts: 4
- Joined date: Tue Feb 14, 2006 12:51 am
- Post datetime: 2006-02-21T14:56:01+00:00
- Post Title: 

xttocs helped out with assembly code for the other three I'm fairly sure.

I've sent a mail to Nicoli, I only found one address, but I'm fairly sure I can track him down one way or another. Avenger might be more difficult as whereas Nicoli is still on the current version of the site in question, Avenger is no longer on the staff, as I found the emails on a cached page.
## Post #18
- Username: Bane
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Sun Feb 12, 2006 4:23 am
- Post datetime: 2006-04-26T18:31:36+00:00
- Post Title: 

I was just wondring if there was any new infor on this?  This seems to be one of a very few games that no one has been able to extract anything for the .dat file.
## Post #19
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2006-04-26T23:40:58+00:00
- Post Title: 

Well, we've recently had a new person posting some interesting ideas at the WIKI... Head on over and have a look: [Main Page](http://wiki.xentax.com/index.php/Guild_Wars_DAT) | [Discussion page](http://wiki.xentax.com/index.php/Talk:Guild_Wars_DAT)
## Post #20
- Username: nicoli_s
- Rank: advanced
- Number of posts: 77
- Joined date: Fri Jan 07, 2005 2:47 pm
- Post datetime: 2006-06-03T14:14:06+00:00
- Post Title: 

hi guys, just checked my hotmail account and got that message. as far as how much info we have on GW, all the real info is on the wiki. I'll try and talk to the guy who made the extractor for us and see if he'll release the source. last time i tested it, it extracted all the files, but no real filenames, so it was pretty difficult to tell what was what. xttocs was able to find a few audio files and i was pretty certain at one point i had found the model files, but i cant remember now where they would have been.
## Post #21
- Username: Joey B
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Sat Jul 08, 2006 12:15 am
- Post datetime: 2006-07-07T16:19:44+00:00
- Post Title: 

I am new to this, but it seems to me that you could decompile the exe, look for that part that unpacks the data and use that same algorithm.
## Post #22
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2006-08-15T05:07:18+00:00
- Post Title: 

I'm not sure if this would be of any use to you guys but I've been able to get a good amount of the textures/skins from GW via a DLL hook. Not sure if having a look at these would be of any use to you? It appears GW will also build skins on-the-fly by looking at your armor, hair type, etc. and will jam most of it together into one single DDS. This may be why you guys are having some problems.

> Reply from Joey B
>
> I am new to this, but it seems to me that you could decompile the exe, look for that part that unpacks the data and use that same algorithm.

Unless you're a very good hacker or know ASM really really well this is impractical. As a bit of a programmer myself I found the only way to look at the source outside of the actual operations the CPU performs (ASM, or assembly language) is if you have it to begin with... Turning it back into C/C++ or something else a bit more readable can't be done at time of writing.
## Post #23
- Username: Bane
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Sun Feb 12, 2006 4:23 am
- Post datetime: 2006-09-20T00:45:37+00:00
- Post Title: 

Did anyone ever find a method of extracting the files from the gw.dat.  I also checked the wiki page, but nothing seems to be updated as of late, didn't know if this was still being looked at.
## Post #24
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2006-09-21T01:25:31+00:00
- Post Title: 

Nope, not yet. I've hooked stuff from the draw calls, but that's really the farthest we've gotten.
## Post #25
- Username: AnonAMouse
- Rank: n00b
- Number of posts: 10
- Joined date: Mon Jan 15, 2007 8:30 pm
- Post datetime: 2007-01-15T12:40:42+00:00
- Post Title: 

decompression easy, extraction harder. 
gw.exe -image to download the decompressed gw.dat 

(The game client with this switch on the command line or in the shortcut (-image only as you cant run the game with this switch active) will download and decompress the files in gw.dat, it still leaves you the issue of ripping files etc but at least its already decompressed.)
## Post #26
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-01-16T02:16:19+00:00
- Post Title: 

I can imagine that would improve performance a bit as well, with GW being the uber-demanding game it is, every little bit helps 

This would probably scrap most of the progress on extraction so far, too. How is it in terms of size comparison?
## Post #27
- Username: AnonAMouse
- Rank: n00b
- Number of posts: 10
- Joined date: Mon Jan 15, 2007 8:30 pm
- Post datetime: 2007-01-16T10:54:32+00:00
- Post Title: 

As for the size difference it obviously depends on which guild wars games(/expansions) you have installed, but for me a 2.5 gb special edition gw.dat expands to about 3.5 gb and yes it does seem to speed zone transition up a fair bit, your mileage may vary.

Regarding gw.dat contents I found this info here: [http://uk.pc.ign.com/articles/534/534454p2.html](http://uk.pc.ign.com/articles/534/534454p2.html) linked from: [http://vnboards.ign.com/guild_wars_gene ... 404/p1/?12](http://vnboards.ign.com/guild_wars_general_board/b22740/86266404/p1/?12)

> Jeff Strain: While no game is hack-proof, our goal is to provide you a very secure game environment. We accomplish this by developing a game structure that is hard to break and easy to fix. The foundation of our secure gaming environment is our client asset model.
>
> 
>
> With Guild Wars, all the file assets placed on your computer are assets that are not directly associated with the logic of the game. Hence they are considered "dumb" assets. They include art assets, music files and the like. All of the files related to the logical systems of the game - the "intelligent" assets -- are held only on our secure servers. Limiting access to the intelligent assets of the game makes it more difficult for the game to be corrupted. Most games are designed first as a single-player experience, and the source files are stored on the gamer's computer. Therefore the files have a greater inherent vulnerability to hacking. The design of Guild Wars as an online-only game allows us to maintain our source code in the most secure manner possible, on our servers.

And for the person who was asking about adding / modifying the music… [http://www.directsong.com/support/helpd ... .asp?ID=17](http://www.directsong.com/support/helpdesk/issue_view.asp?ID=17) …explains how to get direct song music into guild wars, it may or may not help him.

Ok more info, they also seem to be using a variation of the MPQ format.

> In general, MPQ archives don't contain names of archived files.
Found here: [MPQ archives - Name breaking](http://www.zezula.net/en/mpq/namebreak.html)
As it only has hashed filenames. 

Hope you find this information useful.
## Post #28
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-01-16T20:16:32+00:00
- Post Title: 

That would actually make a lot of sense, considering the gibberish filenames of the few successfully extracted files.
## Post #29
- Username: Nukem
- Rank: ultra-n00b
- Number of posts: 7
- Joined date: Thu Sep 28, 2006 9:00 pm
- Post datetime: 2007-01-17T07:40:49+00:00
- Post Title: 

> Reply from AnonAMouse
>
> Ok more info, they also seem to be using a variation of the MPQ format.
In general, MPQ archives don't contain names of archived files.
As it only has hashed filenames.

Just because of that it doesn't have to be a "variation of the MPQ format".  

If so, it was also a variation of the WAVE format, as it stores data binary, too...   


I guess Diablo III MPQs will have >256 chars per filename, and be completely randomized regarding directories / serialization.  
Then it is time to make a REAL Seti@Home clone built on KAD and completely decentralized.
## Post #30
- Username: AnonAMouse
- Rank: n00b
- Number of posts: 10
- Joined date: Mon Jan 15, 2007 8:30 pm
- Post datetime: 2007-01-17T13:52:47+00:00
- Post Title: 

> Reply from Nukem
>
> Just because of that it doesn't have to be a "variation of the MPQ format".
Yeah but if you read my message I did cover this with:

> Reply from AnonAMouse
>
> Ok more info, they also seem to be using a variation of the MPQ format.

> Reply from Nukem
>
> If so, it was also a variation of the WAVE format, as it stores data binary, too...
Possible but in that case it is also a variation of the binary format  

> Reply from Nukem
>
> I guess Diablo III MPQs will have >256 chars per filename, and be completely randomized regarding directories / serialization.
Don't know about Diablo III MPQs...
But it's interesting how DirectSong merges it's music into a players version of the game: [http://www.directsong.com/support/helpd ... .asp?ID=17](http://www.directsong.com/support/helpdesk/issue_view.asp?ID=17)
## Post #31
- Username: Rosuto
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sun Jan 21, 2007 7:11 am
- Post datetime: 2007-01-20T23:15:45+00:00
- Post Title: IVE DONE IT ^_^

well ive   secesfuly gotten the textures form guildwars 

tell me if you are interested 

i know how to get all shaders and textures and even wire frame  form guildwars  so let me know
## Post #32
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-01-21T02:54:19+00:00
- Post Title: IVE DONE IT ^_^

yes, lovely. We've already been able to do that. Please read the entirety of the thread before posting, it makes this sort of thing unnecessary.
## Post #33
- Username: AnonAMouse
- Rank: n00b
- Number of posts: 10
- Joined date: Mon Jan 15, 2007 8:30 pm
- Post datetime: 2007-01-23T21:15:29+00:00
- Post Title: IVE DONE IT ^_^

I just deleted my gw.dat as part of a defrag and once I re-downloaded it I noticed that my settings for interface, graphics, sound etc was messed up and had to be re-adjusted along with my account remember me information (acct email) which was unchecked and missing, so it seems this information is also stored in the gw.dat file.

Hopefully this info helps the group as (if i'm correct) the upper section of the gw.dat file (should be the section that) contains this information, meaning that there is a way to use this to see the differences between two almost identical gw.dat files

Anyone let me know if they notice this effect too?
## Post #34
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-01-23T21:55:48+00:00
- Post Title: IVE DONE IT ^_^

Just out of curiosity did you delete any other files/folders? While storing client data on their physical computer is far from unheard of in an MMO, I've never seen an instance where it's located in an archive.

I have to hand it to these guys, the programmers over at NCSoft are clever b*stards  But on the other hand it's been stated that most of the architecture is designed to baffle any potential hacker into submission.

I can only imagine how fun this is going to be once quantum mechanics becomes the security standard
## Post #35
- Username: AnonAMouse
- Rank: n00b
- Number of posts: 10
- Joined date: Mon Jan 15, 2007 8:30 pm
- Post datetime: 2007-01-23T22:20:35+00:00
- Post Title: IVE DONE IT ^_^

> Reply from OneOneSeven
>
> Just out of curiosity did you delete any other files/folders? While storing client data on their physical computer is far from unheard of in an MMO, I've never seen an instance where it's located in an archive.
Nope, but as i mentioned before this is 'dumb' data and game information, such as your account email and screen res/pc settings for the game.

> Reply from OneOneSeven
>
> I have to hand it to these guys, the programmers over at NCSoft are clever b*stards  But on the other hand it's been stated that most of the architecture is to baffle any potential hacker into submission.
From what I have been able to fathom out from various research is the hardcore info is serverside, we just get the gfx, sound etc. and our pc's get told when to use this stuff.

Look at the fact there isn't any local output for the "Logitech® G15" keyboard's lcd screen, oh they have it for "Auto Assault" but, 
not for Guild Wars see here: [Play NC Support: Logitech® G15](http://uk.support.plaync.com/cgi-bin/nceurope_eng.cfg/php/enduser/std_adp.php?p_faqid=5233&p_created=1160502819&p_sid=_j2n9rsi&p_accessibility=0&p_redirect=&p_lva=&p_sp=cF9zcmNoPTEmcF9zb3J0X2J5PSZwX2dyaWRzb3J0PSZwX3Jvd19jbnQ9Mjc3JnBfcHJvZHM9NjAmcF9jYXRzPSAmcF9wdj0xLjYwJnBfY3Y9JnBfcGFnZT0y&p_li=&p_topview=1)

> Reply from OneOneSeven
>
> I can only imagine how fun this is going to be once quantum mechanics becomes the security standard
Yup, and "Windows® Vista™" isn't supported by Guild Wars either yet see here: [Play NC Support: Windows® Vista™](http://uk.support.plaync.com/cgi-bin/nceurope_eng.cfg/php/enduser/std_adp.php?p_faqid=5335&p_created=1161376258&p_sid=_j2n9rsi&p_accessibility=0&p_redirect=&p_lva=&p_sp=cF9zcmNoPTEmcF9zb3J0X2J5PSZwX2dyaWRzb3J0PSZwX3Jvd19jbnQ9Mjc3JnBfcHJvZHM9NjAmcF9jYXRzPSAmcF9wdj0xLjYwJnBfY3Y9JnBfcGFnZT0y&p_li=&p_topview=1)
## Post #36
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-01-24T02:25:37+00:00
- Post Title: IVE DONE IT ^_^

> Reply from AnonAMouse
>
> 
OneOneSeven wrote:I have to hand it to these guys, the programmers over at NCSoft are clever b*stards  But on the other hand it's been stated that most of the architecture is to baffle any potential hacker into submission.
From what I have been able to fathom out from various research is the hardcore info is serverside, we just get the gfx, sound etc. and our pc's get told when to use this stuff.

Generally that's the way it works with most online/multiplayer games. Transmitting anything else is a huge bandwidth hog.

Also I believe most MMO hacks revolve around reverse-engineering of certain resources used in tracking the player and their actions. They can then take advantage of this to spit out packets with information that has been modified by said client, and can result in duping the server into thinking the player possesses certain items or quantities or even abilities and stats. The additional layers of protection help ensure that no hacker will be able to figure out a means of fooling the server. In certain cases certain ingame assets can be modified for the player's advantage, such as  changing the player skins in Counter-strike to  bright orange or blue, thereby giving ample warning as to the positions of other players. In theory some of the sounds (e.g. silenced weapons) could also be muddled with in order to completely circumvent the benefit.

On the other hand things like this are sometimes used for good rather than evil. I'm thinking primarily of the old (really good) SWG in this instance, but similar concepts can be found throughout the community. Anyhow there's been an ongoing project to reverse-engineer the communications for the pre-EQing client and server taken from old packet logs. Considering the minute amount of information available to them, the dev team has done an admirable job, succeeding in not just creating a connection the program will accept, but even adding most functionalities back to the game, such as vendors. This new server program has been released within the community, and certain benevolent individuals are operating industrial-strength server machines and are hosting their own SWG server.
## Post #37
- Username: AnonAMouse
- Rank: n00b
- Number of posts: 10
- Joined date: Mon Jan 15, 2007 8:30 pm
- Post datetime: 2007-01-24T08:52:04+00:00
- Post Title: IVE DONE IT ^_^

Hmmm, just spotted a gw.tmp 0 byte file, and doing a search for gw.tmp and found GW.TMP-********.pf a 45.5k prefetch file containing references to gw.tmp too

This is not the whole GW.TMP-********.pf file but to quote the above info: 
> \ D E V I C E \ H A R D D I S K V O L U M E 2 \ P R O G R A M   F I L E S \ G U I L D   W A R S \ G W . T M P   \ D E V I C E \ H A R D D I S K V O L U M E 2 \ W I N D O W S \ S Y S T E M 3 2 \ S O R T K E Y . N L S   \ D E V I C E \ H A R D D I S K V O L U M E 2 \ P R O G R A M   F I L E S \ G U I L D   W A R S \ G W . E X E
Dont know if this is of any use, but this file also contains data...

Note: ******** is an 8 character hex file reference.

Edit: GW.EXE-********.pf found and it contains references to my DirectSong Directory.

I wonder if they are using prefetch to also store directories, filenames and settings?
## Post #38
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-01-24T22:39:09+00:00
- Post Title: IVE DONE IT ^_^

Afraid I can't help you there. I haven't heard of this happening much, but in theory it should be possible.
## Post #39
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-04T13:48:00+00:00
- Post Title: IVE DONE IT ^_^

OK.  I've made some progress on this.

Theory 2 (from the article page) and flag theory 2 are the correct ones.  Theory 1 can be thrown out. 

I figured out how the hash table works.

Here's what happens.

When the program reads the "big file" section mentioned in the discussion, it first makes sure that it has the proper number of files, by reading through the whole list, skipping zero entries (which can happen if your gw.dat has been around for a while). 

Providing this is ok, it then does a binary sort of the "big file" section sorting according to the offset of the file.   It does this so it can use the hash table.  So they are in order by block offset.

Then, it does something that I'm not completely sure why happens. It then reads through each record of the big file again, taking the size of the file and comparing it to the location of the next record. If they mesh, it then continues on. But sometimes, the files appear to overlap, in which case the program then makes a linked-list containing these "big" records. This happens even in a fresh gw.dat. So some fo the records are not contiguous?  Maybe this has something to do with the ffna files.  I'll have to look.

After this is finished, it moves the sorted list in memory and then loads in the "hash" table. 

It makes sure that there are the right number of records (which seems to be total number of records shifted right (divided) by 3) and that none of them are blank and that the records are sequential. Not every seq. number is represented, for example it might go 10,10,1F because of the size of some of the files I think. 

Anyway, it then makes a linked-list of this too, appending a counter to it in memory. The it gets sorted as well.

Here's what that hash file actually does. Each record is two double-words. The left-most double word is a FILE NUMBER, NOT A COUNTER.  The right-most is an INDEX where the file resides in the gw.dat.

Some files have TWO entries, which is because the pointer of the file won't fit in 32-bits all the time. At least so I think so far. This might also be why some of the files that seem to be larger than allowed are thrown into the linked-list. 

So anyway, let's say for example the program wants to read the preferences file. It happens to be file number 3. It looks file number 3 up in the hash table, and gets the index of 1cbba. 

Then, it performs the following calculation on it: 

It would take, for example, 1cbba and multiply it by two, and then add 1cbba to it. 

Then, that value is multiplied by 8 and then added to the very beginning of the MFT.  NOT the section where the big file resides, but the true beginning of the mft (where the word 'mft' actually is).

Pseudo code would by: 

FileIndex = 1cbba; (note: this number changes when the .dat gets updated)
FileIndex = FileIndex + (1cbba * 2); 
FileIndex = BeginningofMFT + (FileIndex * 8 )

BTW. File #10 is the executable itself, which is in the gw.dat probably to compare checksums so people like me don't fiddle with anything. 

Now, I'm not 100% sure yet HOW it determines what files to look up, but at least SOME of them are hard-coded.  The preferences file, which is 3, is hard coded.

Next up is busting the decompression so we don't have to use the stupid GW itself to decompress the files. 

It look to be a variant of Huffman encoding, and doesn't look all that complicated.  Itr creates a big Huffmn tree and pushes it on the stack, and then uses it as a look-up to decode.  Shouldn't take me too long.

Then, it is on to decoding the file formats.

Is anyone else working on this?

BlackDragon
## Post #40
- Username: nicoli_s
- Rank: advanced
- Number of posts: 77
- Joined date: Fri Jan 07, 2005 2:47 pm
- Post datetime: 2007-02-05T16:42:55+00:00
- Post Title: IVE DONE IT ^_^

i havent looked at it in ages, but if you can get the files extracted and decompressed, I'll certainly take a look at reverse engineering them
## Post #41
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2007-02-05T18:18:00+00:00
- Post Title: IVE DONE IT ^_^

In the meantime, feel free to update the [WIKI specifications](http://wiki.xentax.com/index.php/Guild_Wars_DAT) with your findings... If Theory 1 is, indeed, incorrect, it should be deleted.
## Post #42
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-02-06T17:02:07+00:00
- Post Title: IVE DONE IT ^_^

I'd be willing to bet the contiguity check is to verify that files haven't been tampered with-- i.e. you can't modify a file by replacing all the data in the original chunk with whatever you intended: if the file's too small, the ends won't line up; if it's too large you can't fill up the space and include the rest offset over at the end. The overlap might have something to do with compression?
## Post #43
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-06T18:23:22+00:00
- Post Title: IVE DONE IT ^_^

> Reply from OneOneSeven
>
> I'd be willing to bet the contiguity check is to verify that files haven't been tampered with-- i.e. you can't modify a file by replacing all the data in the original chunk with whatever you intended: if the file's too small, the ends won't line up; if it's too large you can't fill up the space and include the rest offset over at the end. The overlap might have something to do with compression?

I'm not sure yet.  Right now, I don't think it is all that important, as I want to write code for decompression and then see how it determines what files to  load in, if they are all hard coded.  I wouldn't think it is so...I'll bet that the ffna files have links to other files in them.

Don't hold me to that though, it's just a thought.

I've had a lot of downtime in the last few days, I'm hoping to pick this back up soon.

BD
## Post #44
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-02-07T21:38:43+00:00
- Post Title: IVE DONE IT ^_^

The second idea is pretty random, I just threw it out there. When all's said and done, however, I think the anti-tampering thing is pretty viable, especially when you factor in compression to the final filesize.
## Post #45
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-16T00:00:57+00:00
- Post Title: IVE DONE IT ^_^

OK.  I finally got back to work on this.

As a side note, DON'T upgrade to Vista yet as I have had an inordinate amount of problems with it.

Anyway, I was playing around with this linked-list record issue mentioned above, and just decided to strip the whole section out of the code just to see what happens.

It loaded everything fine, but there were lots of GFX issues when doing so, and it corrupted my gw.dat.

Oh well. 

Anyway, a little more information about this.

After the file pointers are sorted it then goes back through each one record by record.  In the last gw.dat I had the first record was 20 (which seemed to be empty), the second was 200, then 400 then a big jump to 15E000 something.  Keep in mind this is the physical location in the gw.dat that these numbers are a pointer to.  It uses the hash table to find a specific file.

So, what it does it load in the value for the size of a file, run a small algorithm on it (which verifies it is on a 512 byte-boundary) then adds the size of the file to the pointer to the physical location and then stores it.  

Then, it compares that stored number to what was calculated PREVIOUSLY to make sure the sizes match.

Sometimes however, the file is SMALLER than what it should be, meaning there is a gap between the calculated physical offsets of this record and the previous one.  This is then when the file size and location is pushed into the linked list.

I've tried to look for any kind of file features that stand out, like maybe all of these files in the list are ffna files or something, but haven't seemed to notice a pattern yet.

I'll keep plugging along.

Suggestions and thoughts are welcome.

I've also finally started on the decompression.  It doesn't look complicated, just as mentioned previously, but it sure is long.

BD
## Post #46
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-02-16T02:00:15+00:00
- Post Title: 

Odd, I never regretted my Vista update
## Post #47
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-21T20:09:53+00:00
- Post Title: 

My Vista issue was that my video card kept randomly locking up.

Occasionally the beta nvidia drivers I was running would BSOD too.

None of my hardware is bad, because I thoroughly tested it after I started having problems.  Put XP back on and no issues at all with the same exact hardware.

Anyway, I continue to plug away on GW.  The decompression code is so long and boring it's been difficult to get through, though I have pseudo-code done but it isn't complete.

But a few other thoughts as I go through the program.

I think I figured out what the linked-list is for.  Because GW doesn't actually physically delete files, but just overwrites them, I think this list is the ADJUSTED file size.  Because if the new data is smaller than the old data, there will be data left over.  Obviously.  This keeps track of it.
This is mentioned at the start of the wiki discussion so I think it is right.  If the new data is bigger, it puts it at the end.  Makes sense.

So while I force myself through the decompression code I made a few other potential discoveries.

The is a file that is processed by the code called a "depends" file.  This is either a list of all the files and their version numbers, or this file has a version number which is checked against a master at ArenaNet.  Then, if it is different, it loads this file in and decides what new files have to be downloaded or changed.

After this is done, it decompresses another file that I THINK is a master file of some sorts.  It's called a composite file in the code.  This MAY be the file that is loaded to determine how to load in all the OTHER files, this is possibly an ffna master list.

I also started reversing the ffna file format, but it is in it's early stages.

I'm getting there slowly but surely.

Looking at hours of assembly is trying on my patience, but I have a drive to find out how stuff works.  Maybe we should get some WOW guys working on this, as that has been completely ripped apart.

Does anyone else here have any ideas?

Is anyone else here a competent assembly coder?

We should probably have enough data right now to a leats write a file loader, but I don't have time.  Any takers?

BD
## Post #48
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-02-21T22:01:47+00:00
- Post Title: 

That's more nVidia than M$ for you. Despite all the green fanboys whining about how "bad" ATi's drivers are, at least they don't BSOD every 20 mins. on the dot in Planetside, BSOD on update sometimes and generally act funny/CTD when under texture load. (in XP too, btw!) Hating my GF 7900GTX atm.

Enough 'bout that, though.

The 'overwrite' idea strikes me as odd-- Games are very unforgiving when it comes to wasted/extra resources.

I'd also bet the 'depends' is just that-- checks dependencies to see what files need to be streamed from the server/update them if needed.

Also most, if not all loaders are in-executable AFAIK.
## Post #49
- Username: nicoli_s
- Rank: advanced
- Number of posts: 77
- Joined date: Fri Jan 07, 2005 2:47 pm
- Post datetime: 2007-02-22T01:15:22+00:00
- Post Title: 

I'm what i would consider one of the "wow" guys, and while i don't know much assembly, i have been done lots of reverse engineering on file formats and recently, archives, so if youd like to share what you have got, id be willing to lend a hand
## Post #50
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-22T15:31:52+00:00
- Post Title: 

I'm working on some of these formats now actually.

I've managed to extract all of the files from the .dat, though I have a cumbersome method of doing it as noted above I don't have enough high-level code to decompress on the fly.

If the routine wasn't so long and boring, I'd be done with it already 

Anyway, the sound files are all mp3's, so nothing really needs to be done with those.

I don't know much about the layouts of "typical" graphic files, so I can't say, but I THINK that GW usues custom formats for everything.  There are AMAT files, ffna files, ATEX files etc.

SOME of the files are straight .dds files, but some of them aren't.  Also, sometimes, the ffna files also contain other file types like .dds inside them.

Not sure why they do this yet.

But to do a model viewer or a map viewer, we'll have to know how all of it fits together.

Today, I'll work more on the decompression routine, and see if I can figure out the composite file and the lookup file.

Out of curiosity, do you know how WOW stores quest text?  I have seen all kinds of text decompressed from GW, but never any quest text.  I wonder if it is stored server-side, or if it is actually just a gfx file painted on the screen?

BD
## Post #51
- Username: nicoli_s
- Rank: advanced
- Number of posts: 77
- Joined date: Fri Jan 07, 2005 2:47 pm
- Post datetime: 2007-02-22T19:59:27+00:00
- Post Title: 

wow quest text is all server side, pretty much everything text wise in wow is
## Post #52
- Username: nicoli_s
- Rank: advanced
- Number of posts: 77
- Joined date: Fri Jan 07, 2005 2:47 pm
- Post datetime: 2007-02-22T20:00:12+00:00
- Post Title: 

also, if you can get me a copy of some of the graphics files from GW i can take a look at them, as ive figured out a few mmorpg model formats
## Post #53
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-22T23:12:56+00:00
- Post Title: 

Nicoli,
     I can do that.  How can I get them to you?

BD
## Post #54
- Username: nicoli_s
- Rank: advanced
- Number of posts: 77
- Joined date: Fri Jan 07, 2005 2:47 pm
- Post datetime: 2007-02-23T02:00:20+00:00
- Post Title: 

msn:
[warbeta3@hotmail.com](mailto:warbeta3@hotmail.com)
yahoo:
sanklovich
aim:
sanktanglia
## Post #55
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-23T23:37:40+00:00
- Post Title: 

Nicoli,
     Did you get the files?

I am trying to modify the gwdat C# program listed on the wiki to read files in and extract them.

I have an issue though.  the FileStream "seek" member works with longs, and when the 32-bit value for my gw.dat gets read in, the program thinks it is a negative number, which it isn't.

Is there a way in c# to call a seek function that DOESN'T require a long, or at  least make the number not appear as negative?

BD
## Post #56
- Username: nicoli_s
- Rank: advanced
- Number of posts: 77
- Joined date: Fri Jan 07, 2005 2:47 pm
- Post datetime: 2007-02-24T00:30:23+00:00
- Post Title: 

ive not fooled around with C# enough to help, but i got the files today, and ill be taking a look at them over the weekend
## Post #57
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-02-24T01:04:50+00:00
- Post Title: 

Well if it's 32 bit you'd need something that can hold eight bytes-- maybe typecast a long double or something? Forgive me as my C# is limited, i don't know how many bytes are assigned to the variable types offhand. It sounds like you're having overflow issues.

I remember I have a decent article on file loaders/writers in this one issue of Game Developer I have floating around somewhere, maybe that might be of use *shrug*

C++ is more my field of expertise.

If worst comes to worst, maybe you can FileSeek up to the maximum value allowed for the data type and then run another one from the location you left off at? Assuming you're using a for loop of some kind, it's quick-and-dirty but it works.
## Post #58
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-24T02:55:17+00:00
- Post Title: 

I don't know that much c# either, but I didn't want to start from scratch.

The seek function takes a long, and it just so happens that the 32-bit number (it could also be 64 bit in this instance)  that has the location of the MFT has the high-bit set, so the seek function thinks it is a negative number.

I tried to typecast it, but C# won't let me like you could in c++.

I'll figure it out.  I guess I could just overload the seek function to use an UInt64.

BD
## Post #59
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-02-24T12:35:47+00:00
- Post Title: 

I had the same problem with Seek and I think it's caused by a bug in GWConvert.byte2int64(), because replacing it with 

```
		{
            if (data == null || data.Length < offset + 8)
                return 0;
            else
                return
					( (long)data[offset] ) |
					( (long)data[offset + 1] << 0x08 ) |
					( (long)data[offset + 2] << 0x10 ) |
					( (long)data[offset + 3] << 0x18 ) |
					( (long)data[offset + 4] << 0x20 ) |
					( (long)data[offset + 5] << 0x28 ) |
					( (long)data[offset + 6] << 0x30 ) |
					( (long)data[offset + 7] << 0x38 );
		}
```

fixed it for me.
## Post #60
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-24T14:29:02+00:00
- Post Title: 

That did it!  Awesome.  Good catch.  I tried all kinds of things to get that to work.

So, I'll modify that code and re-post it when I have the loading and extraction and decoding done, which will hopefully be done in a few days.

In the meantime, Nicoli is looking at the decoding file formats and trying to figure them out.

I hope it won't be long now.

BD
## Post #61
- Username: OneOneSeven
- Rank: advanced
- Number of posts: 45
- Joined date: Sun Jul 16, 2006 1:54 pm
- Post datetime: 2007-02-24T16:03:02+00:00
- Post Title: 

Good to hear 

Seeing as I'm going on a language learning spree I may as well try and get the fundamentals of C# down this weekend, if this endeavor is successful I'll have a hack at bug-checking the rest of the posted code with the suggested modifications.
## Post #62
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-02-28T23:36:46+00:00
- Post Title: 

Just some updates.  I'm still plugging away at this, but caught a nasty cold on Monday so haven't had much energy.

I've got the "gwdat" code heavily modified to read in the MFT, sort it, read in the has table and display it, and it now allows you to read files the way GW really does using the hash table.

I have one big to fix in my implementation of the list that has the different file sizes in it, and the screen layout looks crappy, but it works.

I was going to post the notes that I have on the decompression routine, but they are long and convoluted so I'll just add it to the program myself.

Look for the full code in a few days, providing I start to feel better!  At that point we can really start reversing the file formats.

Nicoli, 
     Any progress made yet?  

Even though we don't have filenames, I figured out what some of the files do.  This really won't mean anything until y'all get the tool but here it is nonetheless.

File Number FileName
3 = Preferences File
44FF5 = Dependencies file
33EA = Composite file

BD
## Post #63
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-06T20:46:58+00:00
- Post Title: 

Another update.

I have a sinus infection, so have been off work today.  So I made more progress.  I figure I have about 50-60% of the decompression code done.

It's a straight port from assembly, so it is ugly as all get out, few loops, cryptic variable names, no function calls, but it is functional.

It is some variation of Huffman, as has been suspected, but I know so little of decompression algorithms I can't tell what one exactly.

Someone who knows more about high-level decompression algorithms can clean it up.  I don't have any webspace to upload this too, so can someone host it for me?

BD
## Post #64
- Username: triton
- Rank: beginner
- Number of posts: 20
- Joined date: Mon Mar 05, 2007 10:41 am
- Post datetime: 2007-03-06T21:50:33+00:00
- Post Title: 

Great job, keep us informed.
## Post #65
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2007-03-07T18:13:52+00:00
- Post Title: 

> Reply from BlackDragon
>
> I don't have any webspace to upload this too, so can someone host it for me?

Depending on how big it is, you can email it to me, and I'll find a place to upload it.
## Post #66
- Username: kiasanth
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Thu Mar 08, 2007 10:48 am
- Post datetime: 2007-03-09T00:56:08+00:00
- Post Title: 

Hi, I have been watching over this topic for a while but only just joined the forum. I have some web space if you want me to upload some code or tools or whatever. let me know if you want this.
## Post #67
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2007-03-09T09:47:02+00:00
- Post Title: 

Welcome! 

If you have some code or tools, we'd also be ready to host them. In any event, code/tools and documents are highly welcome at the Game File wiki :

[http://wiki.xentax.com](http://wiki.xentax.com) 

Please do add those if they are not in there!
## Post #68
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-20T02:07:29+00:00
- Post Title: 

Be patient.

The code is done, and it decompresses!

Half of the file lol.  As soon as that is fixed I will release it.

The code is all done, I just have to fix a few remaining loop bugs.

For what it is worth, this class "Decompress.cs" is a stunning example on how NOT TO CODE.

It's a straight translation from assembly, so is really, really sloppy but it works.

Almost.

I even have a bunch of "goto's" in there, replacing the assembly jmp commands.

All of the variables are global.

It's scary, but functional.  I hope no one punches me.

BD
## Post #69
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2007-03-21T22:33:47+00:00
- Post Title: 

Don't worry, BD, I'm sure someone here will take your code and turn it into a beautiful peace of art before long (or, I could just be full of crap... only time will tell  )...
## Post #70
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-21T23:55:09+00:00
- Post Title: 

It isn't fully working yet, but does decompress a lot of the prefs file.  I'm ready to release it so some other eyes can look at it now that it is is C# and not assembly.

Who want to host it?  I can email it to whomever.

Instructions:

When the program loads up, hit the "show Hash List" button.  Find file = 3 (prefs) and then hit decompress.

BD
## Post #71
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-23T19:42:51+00:00
- Post Title: 

Success!  The prefs file now decompresses completely!  I only have one bug left, and that is big files cause an indexing error in one of my arrays.

We're ready to go it looks like.

BD
## Post #72
- Username: Darkfox
- Rank: VVIP member
- Number of posts: 688
- Joined date: Sat Jul 05, 2003 1:11 am
- Post datetime: 2007-03-23T22:42:44+00:00
- Post Title: 

I don't own GW, but from the sound of it I can say it sounds quite good and interesting how this is progressing and I'll say good work BD.
## Post #73
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-03-27T13:17:03+00:00
- Post Title: 

I've just uploaded the [program](http://www.raechaer.de/GWDat.zip). All credits of course go to BlackDragon, I'm just hosting it.

And thanks for all your work, it's appreciated
## Post #74
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-27T14:01:34+00:00
- Post Title: 

Thanks for hosting it.

I'm still working on getting the rest of the files to decode, but prefs works fine.

If anyone makes any code changes let us all know so we don't have 90 version floating around.

BD
## Post #75
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-03-27T16:37:16+00:00
- Post Title: 

Hmm, I just gave it a try, and after a few small bug fixes it at least starts and I can select the files in the listview without exceptions, but I didn't manage to decompress any of the files (I got an index out of range exception on all the ones I tried).
Any idea on what I'm doing wrong?
## Post #76
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-27T22:52:12+00:00
- Post Title: 

> Reply from Irina
>
> Hmm, I just gave it a try, and after a few small bug fixes it at least starts and I can select the files in the listview without exceptions, but I didn't manage to decompress any of the files (I got an index out of range exception on all the ones I tried).
Any idea on what I'm doing wrong?

The only file that decompresses is the preferences file, which is file 3.  It's usually at the end of the list.

I'm working on fixing the problem with the other files.

BD
## Post #77
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-03-27T23:30:39+00:00
- Post Title: 

File 3 is the entry in the HashList with filenumber 3? When I try to decompress that one I get an exception.
I did find a few files where decompress doesn't throw an exception, but the decompressed file always only consists of zeros.

And don't get me wrong, I'm not complaining, just trying to get it to work 

Oh, and I've fixed a few bugs (couldn't find the path to GW.dat on Vista x64, selecting the same entry twice in the Hashlist didn't work) and improved the GUI a bit (it's now resizable, made the ListViews virtual so Show Hash entries is much faster now, the HashList is now sortable when clicking on column headers, ...). No changes at all to the Decompress.cs, way too scary in there 

Should I just post a link to my version here or should I mail it to you so you can check it out first?
## Post #78
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-27T23:50:34+00:00
- Post Title: 

Just put it somewhere where everyone can get to it.  I don't need to look at it specifically.

And yeah, it is file number three.

The exceptions are caused because of the StorageTable.  I have the value hard-coded in there for the prefs file, but it is supposed to be dynamic.  So files larger than 0x438 will cause the exception.
I missed that the first time around, but it is fixed in my new (unreleased) version.

The Huffman tree doesn't work right with the other files yet, but I'm working on it.

If you can re-write the decompression code, by my guest 

I just wanted to get it working enough so that other eyes can look at it.

BD
## Post #79
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-03-28T08:05:39+00:00
- Post Title: 

Ah, I see. And yes, the exceptions are in the StorageTable.

And here's [my version](http://www.raechaer.de/GWDat_001.zip), should be easier to work with because it no longer takes several seconds to show the HashList.
## Post #80
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-28T23:09:19+00:00
- Post Title: 

Hi Irina
     I DL'd your version, but it didn't work.  When I selected the prefs file it gave me all zeros, so are you passing the right file number though?

BD
## Post #81
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-03-28T23:27:35+00:00
- Post Title: 

Weird, both your and my version show the same content for file number 3 for me (and for all other files I checked). 
I also checked HashList_SelectedIndexChanged() with the debugger, and it always used the HashInfo with FileNumber 3 when I clicked on file 3, so I have no idea at all why it's not working for you. 
I'll give it another look tomorrow, should have some time for it then.

Oh, when you say it's all zeros, is that right after selecting it or only after decompressing it?
## Post #82
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-29T00:04:57+00:00
- Post Title: 

Right after decompressing it.  Did you change anything in the decompress.cs?
I haven't had much time the last few days.

BD
## Post #83
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-03-29T09:21:12+00:00
- Post Title: 

No changes at all to the decompress.cs, I think all my changes are in the View.cs.

Does the decompressing work with the version you emailed me?  For me they both work the same (i.e. exception on most files, all zeros on others), but if that version works for you I guess I must have broken something.
## Post #84
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-29T13:07:53+00:00
- Post Title: 

Yeah, it does, for the prefs file.

In fact, I still have the original and double-checked it last night.

The files size for file three is supposed to be 200, but yours is passing 208 through, so something isn't right.

I hope to get back to the code today and start making decompression work for the other files.

The routines are the same, so it has to be a math error somewhere.

BD
## Post #85
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-03-29T13:48:51+00:00
- Post Title: 

Hmm, I've just tried your and my version, and they both pass the same 520 (=0x208) byte Array to DecompressFile() when I try to decompress file 3. Also both versions display exactly the same in the hex view when selecting file 3.

Probably made a small stupid mistake somewhere, but I just can't find it 

Btw, what GW.dat are you using? Did you download a complete one with -image?
## Post #86
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-03-29T15:25:15+00:00
- Post Title: 

I'm using the most recent version of gw.dat, and it is the full gw.dat because I did use -image.

BD
## Post #87
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-04-03T18:52:17+00:00
- Post Title: 

Yet another update.  

I continue to plug away and fix bugs.  I've found several, including a BIG one relating to the Huffman Tree, which is why files bigger than 0x200 bytes just got all zeros when you tried to decompress them.  I was missing a whole section of code dealing with the larger files.

Oops.

I also found a few math errors, and one of the tables had two of the bytes accidentally swapped. 

All of the values that were hard-coded in order to make the prefs file work are gone, and everything is dynamic like it is supposed to be.

Hopefully in a few days all files will decompress.  I don't think I've missed any more code sections in the executable.

BD
## Post #88
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-04-03T19:52:25+00:00
- Post Title: 

Good work 

Did you get it to work with my version? If not I'll wait till you release a version that can compress files for me, so I can test myself what's working and what I somehow made stop working 

Oh, and feel free to email me any versions you want to have posted here.
## Post #89
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-04-04T12:37:20+00:00
- Post Title: 

No, I was using my old version.  Sorry.  I wanted to keep everything as simple as possible to find bugs.

BD
## Post #90
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-04-09T20:08:19+00:00
- Post Title: 

OK.  Here's where I am at.

Some files, not just the preferences file now decompress!  I've seen some ffna, ATEX and such in there.

Unfortunately, due to a real-life issue, I can no longer continue to code on this project, at least in the foreseeable future.  Hopefully someone else can come in and finish it.

I'll still be around to help with questions if I can.

Irina, I'll send you the latest file.  Send me a message, as I didn't save your email address.

Here's what works.  Smaller files seem to decompress fine.  Bigger files decompress partially, but the executable does a frickin' recursive call, so while the code is in there to do it in my decompress.cs, it isn't tested.

Some files cause a crash because they get a negative number.  I've marked this area in the code with "stopme" so someone can take a look.  Also, the recursive section has a "check this" comment on it.

Still, there should be more than enough in here for someone to work with.

So, fire away guys.  And gals.

BD
## Post #91
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-04-12T08:38:00+00:00
- Post Title: 

Aww, too bad you can't continue working on it, but thanks for all the work you've done!

Here's the [latest Version](http://www.raechaer.de/GWDat_002.zip) for those who want to continue working on it.
## Post #92
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-04-12T12:53:44+00:00
- Post Title: 

You did good work on this too.  This one actually decompresses the stuff right.  Cool.

There's a lot there for anyone to work on.  I wonder/hope if GW2 uses the same algorithm so no one has to do this again 

BD
## Post #93
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-04-12T13:10:06+00:00
- Post Title: 

The funny thing is, I didn't change anything at all in my code, just added your new decompress.cs to my version and it worked. Guess we'll never find out why my old version didn't work for you
## Post #94
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-04-12T14:05:26+00:00
- Post Title: 

So does this decompress your prefs file properly then?  That's great if it does.

Lots of other files work now too.  IF I get time, I'll  look at that crash bug.

BD
## Post #95
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-04-12T15:33:37+00:00
- Post Title: 

Yes, works fine for my prefs file (and many other files too).
## Post #96
- Username: Ravious
- Rank: ultra-n00b
- Number of posts: 5
- Joined date: Tue May 01, 2007 11:11 pm
- Post datetime: 2007-05-01T15:58:32+00:00
- Post Title: 

Has there been any new work done on this lately?  I think a lot of GW fans are really excited about the possibility of an eventual model viewer, etc.

If anyone ever needs a test monkey, let me know!
## Post #97
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-05-02T13:50:51+00:00
- Post Title: 

An anonymous programmer has been making a TON of changes and has pretty much fixed most of the decompression, and has an image viewer.

So be patient, more is in the works.  There is no release date yet.

If he/she wants to talk about it they will post 

Otherwise, you'll have to wait until I get some time to incorporate his/her changes 

BD
## Post #98
- Username: Ravious
- Rank: ultra-n00b
- Number of posts: 5
- Joined date: Tue May 01, 2007 11:11 pm
- Post datetime: 2007-05-02T17:39:53+00:00
- Post Title: 

Awesome! Looking forward to your work, anonymous he or she programmer.  Thanks for the update, BlackDragon.
## Post #99
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-06T16:04:23+00:00
- Post Title: 

Hi guys, the "anonymus" coder here

[http://digitaldynamite.demoscene.hu/pri ... packer.zip](http://digitaldynamite.demoscene.hu/private/BoyC/GW/GW_Unpacker.zip)

LET THE GAME-DATA EXPLORING BEGIN :))))

I'll now take a bit off from this because it was quite exhausting :)
Have fun!
## Post #100
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-05-06T16:33:20+00:00
- Post Title: 

Haven't tried it yet, but looks good, thanks for your work!

Is it ok if I try to write a GUI for it?
## Post #101
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-06T16:49:52+00:00
- Post Title: 

Yeah sure, that's why the source is in there. Just use it.
## Post #102
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2007-05-06T19:38:43+00:00
- Post Title: 

Hmm... Is there any particular reason two of the files are named xentax?
## Post #103
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-06T20:34:51+00:00
- Post Title: 

> Reply from Dinoguy1000
>
> Hmm... Is there any particular reason two of the files are named xentax? :wink:

Hehe, yeah :)
This was my nth go at this file format and now I based it on blackdragons code from here :) In the end I threw out everything he wrote but it was very educational.
## Post #104
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-05-07T14:23:08+00:00
- Post Title: 

He did good work on this.

It's time for us to decode the rest of the file formats.

BD
## Post #105
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-07T20:48:55+00:00
- Post Title: 

You mean it's time to decode the almost single file format that's left - upon depack the result is about 4 gigabytes, half of it is textures and sounds and the other half is ffna files. So it's definitely game data :D
## Post #106
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-05-08T13:31:08+00:00
- Post Title: 

Yeah, the ffna's and also the "unsorted" are data of some sort.  I still think that the ffna files have to have pointers to other files that tell the game what to load for a specific instance.

But, I'm looking into it more to see what is going on.

BD
## Post #107
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-08T15:48:28+00:00
- Post Title: 

some of the unsorted files are actually materials, those files start with AMAT, and it looks like they contain dx9 shaders and some other stuff.
## Post #108
- Username: mqstout
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Wed May 09, 2007 10:39 am
- Post datetime: 2007-05-09T06:47:36+00:00
- Post Title: 

I was looking through the unsorted files a bit this evening.  I had a script separate out the AMAT files and I made a list of them.  I also made a list of those that obviously contained textual information in the game.  I only got up to about file number 40000 though.  Some of the text is interesting.  There are skill descriptions of removed skills (keyword: REMOVE all caps), and some skill descriptions that seem to be like they're already in there from the up-coming expansion.

I'll keep poking casually with these.  I like text.  Might start trying to correlate files of different languages.

I guess I can't attach text files, so wastefully I zipped them.
[GWDat.zip](https://xentaxbackup.github.io/file/1148_GWDat.zip)
## Post #109
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-05-09T12:22:28+00:00
- Post Title: 

I've finished a first (and probably quite buggy) version of my GUI. It can display all the textures (except .dds files), all other files are shown in a hex editor, and of course the files can also be exported.

I only tested it on Vista, but I think it should run on XP too.

Source is included (you better not look at it though, it's rather ugly ), but please don't distribute any modified versions if you make any changes, send those changes to me instead and I'll add them.

Get it here: [http://www.raechaer.de/GWDatBrowser.zip](http://www.raechaer.de/GWDatBrowser.zip)


Oh, and does anyone know of an easy way to display the .dds files (other than using Direct3D and using them as textures)?
## Post #110
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-09T18:58:33+00:00
- Post Title: 

Wow, nice job on the gui!
The dds format is pretty simple, if you look in it you'll see it's uncompressed data. Altho I think it can store several images (different mip levels etc)

Here are the things I miss at first glance:
-the uncompressed size is not displayed in the listing
-the first flag (0x00 or 0x80) is the compression flag
-the alpha in the image display seems incorrect, there should be an option to turn it off
-we really need an mp3 player, bass.dll should be easy to include in the project
## Post #111
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-05-09T19:39:00+00:00
- Post Title: 

Yeah, good job Irina.

I have a question:

I haven't had time to look at the code yet, but what is the "section" and "ID" columns for?

And do you process the hash table?

BD
## Post #112
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-05-09T20:30:15+00:00
- Post Title: 

@BoyC:
I've found some code that reads dds files, but it seemed quite complicated so I didn't take a closer look. If it's really just uncompressed data it might not be as hard as I thought though.

-Displaying the uncompressed size should be easy, I'll add that in the next version. I basically just display all the stuff that your app displayed on the command line.
-Hmm, images with alpha are displayed just fine for me (did you see that you can change the background of it in the context menu?). Can you post a screenshot of a it? Not sure if I can tell GDI+ to draw the image without alpha, but I'll check.
-mp3 player will be added, I just wanted to release a somewhat working version asap 

@BlackDragon:
All the "decoding" of the GW.dat is done by BoyC's Code, so he'll have to answer that. But I don't think he's processing the hash table.
## Post #113
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-09T22:56:43+00:00
- Post Title: 

"Section" is supposed to be sector. The bigfile consists of 512 byte blocks as you know, that number is the number of the start sector of the file.
ID is the value that's in the mft and appears to be sequential when you add the hash table in there. The hash table is not processed only loaded.
I think that's supposed to be a unique file ID as there's nothing else in the mft to uniquely identify a file by.

Edit:
The IDs also seem to show a chronological order of the game being built if you sort them, so it's a safe bet these are the references the game uses to identify and update unique resources.

Oh and irina: the amp files are also mp3 files so add them to "sound", and you should add the files starting with "AMAT" as "material"

As for the alpha thing, you could just add an option to redisplay the image with every alpha byte set to 255, that's it :)
## Post #114
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-05-10T22:31:04+00:00
- Post Title: 

Here's a new version: it now also displays the uncompressed size, it has a very ugly looking player for the mp3s and I also fixed a few bugs (and probably introduced new ones ).
No source this time because it's late and I'm lazy, if anybody actually wants/needs it just tell me and I'll upload it.
[GWDatBrowser_02.rar](https://xentaxbackup.github.io/file/1150_GWDatBrowser_02.rar)
## Post #115
- Username: mqstout
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Wed May 09, 2007 10:39 am
- Post datetime: 2007-05-11T01:54:53+00:00
- Post Title: 

It's minor, but I found a pattern in a bunch of the unsorted files that contain text/strings.  The 2nd to last byte seems to indicate language.  While it's not perfect (especially with English), it really feels like there's something to it.

decimal  values
0	english
1	korean
2	french
3	german
4	italian
5	spanish
6	chinese traditional
7	chinese simplified
8	japanese
9	polish
10	russian
17	bork

I ran a few tests changing language options in GW and re-extracting the preference files, and they check.  English in preferences is 0, french is 2, bork is 17 (x11), etc.  A couple dozen text-containing files I found check out with this.  Most of the files I found with German text had x03 as their 2nd to second to last byte, and those with bork had x11 as their second to last last byte...

There are, however, some that don't (particularly english-text-containing ones).

Up to about 45000 giving quick look-throughs to unsorted files for text.

Edit/Addition:
The following files all appear to be the same file but for different languages:
131188,130964,130962,130966,130834,130968 (it's a list file of armor names starting with Luxon Gloves and Luxon Hose.  They all end in 002E00xx42 where XX is the language.  The first characters differ as well.
## Post #116
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-05-11T13:45:00+00:00
- Post Title: 

I've been working on decoding some of the "unknown" file formats as well as   the ffna files.

ffna files with a type of "2" (which is the byte right after ffna in the raw file) are model files btw.  Someone mentioned somewhere else that GW uses the "granny" software for building models in-game, so if anyone knows anything about that let us know.

Anyway, I have two coding questions.  I use OllyDbg (because it is free, and I can't afford IDA Pro) so my questions related to this.

Does anyone know how to set an OllyDbg breakpoint if a certain range of memory is accessed?  the ffna files build another list, but also do this weird table-based processing and I'm trying to find out if the tables are built dynamically or are hard-coded, because the data in them doesn't make any sense yet.

Also, is there a way to make OllyDbg STOP the gw executable from creating threads and keeping everything (for debugging purposes) in a single thread?

BD
## Post #117
- Username: Ravious
- Rank: ultra-n00b
- Number of posts: 5
- Joined date: Tue May 01, 2007 11:11 pm
- Post datetime: 2007-05-11T14:50:28+00:00
- Post Title: 

Granny refers to Rad Game Tools program:

[http://www.radgametools.com/granny.html](http://www.radgametools.com/granny.html)

Awesome job guys on all the stuff!
## Post #118
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-11T17:40:55+00:00
- Post Title: 

> Reply from BlackDragon
>
> Does anyone know how to set an OllyDbg breakpoint if a certain range of memory is accessed?

In the memory dump select the memory range you want to have the breakpoint on, right click and it's in the menu somewhere.

> Reply from BlackDragon
>
> 
Also, is there a way to make OllyDbg STOP the gw executable from creating threads and keeping everything (for debugging purposes) in a single thread?
BD

That would be a no go from an engineering point of view - in order for the client to run in single threaded mode you'd most probably have to rewrite the whole thing.
## Post #119
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-05-11T17:46:52+00:00
- Post Title: 

Ok, wild guess here: what if the ffna files stand for "ArenaNet File Format"? If they wrote 'anff' for the ID string in the source, it'd be reversed because of the endian order... :)
## Post #120
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-05-11T17:59:36+00:00
- Post Title: 

I'd think it probably is "ArenaNet File Format".

I'm working on decoding it now.

BD
## Post #121
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2007-05-12T03:16:52+00:00
- Post Title: 

> Reply from BoyC
>
> Ok, wild guess here: what if the ffna files stand for "ArenaNet File Format"? If they wrote 'anff' for the ID string in the source, it'd be reversed because of the endian order...

Hmm, I never have really understood endianness. I mean, I'm fine with it in concept, it's the real world application that kills me. And what you said there is exactly why.
## Post #122
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-05-14T15:26:04+00:00
- Post Title: 

Been parsing the first ffna file the game loads.  It has a type of "4" after the ffna header.

These appear to be R.I.F.F files of some sort.  The code that processes them is called riff.c, plus the ffna files do appear to have data in them in chunks.

The code to process them is HUGE however, because ArenaNet seems intent on using circular linked-lists (at least that is what the assembly seems to be, I could be wrong, it might be a hash table) for everything, which adds a huge amount of bloat to the code.

If anyone wants to help look at the assembly and figure out this file format, they are more than welcome.

Set a breakpoint on the "test eax,eax" right before the text "cmpDecompress" (it only appears twice) then look at the address pointed to by ebp-4.  This is the buffer to uncompressed data.  Look for "ffna" as the first 4 bytes and then just step through the code.

I don't know what file number it is from Irina's tool.

I'll keep plugging away, but it might be some time before I figure it out.

BD
## Post #123
- Username: nobodyreally
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Wed May 16, 2007 4:30 pm
- Post datetime: 2007-05-16T21:28:34+00:00
- Post Title: 

Irina can i get the latest source dump of your project when you have time to upload it.
## Post #124
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-05-16T22:30:01+00:00
- Post Title: 

Here's the latest source. I was busy lately so there's no new features, but I cleaned up the code a bit.

You might need a full version of Visual Studio 8 with Service Pack 1 (i.e. not the express edition) and the latest windows platform SDK installed to compile it.
[GWDatBrowser.rar](https://xentaxbackup.github.io/file/1157_GWDatBrowser.rar)
## Post #125
- Username: Darkstar
- Rank: advanced
- Number of posts: 67
- Joined date: Thu Jun 14, 2007 8:14 pm
- Post datetime: 2007-06-14T13:33:22+00:00
- Post Title: 

Hiya,

I was following the GW development with increased interest. Is there any news here? A Model viewer would be very cool 

I've still not figured out where/how the 3D data is stored, but maybe I'm just looking at the wrong files? Anyone got any results already?

--Darkstar
## Post #126
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2007-06-14T13:42:50+00:00
- Post Title: 

I don't really have the time now to work on this, but the mesh data is definitely in the ffna files so you should be looking at those.
## Post #127
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2007-06-23T08:53:13+00:00
- Post Title: 

Hey all, I recently got my hands on a copy of Guild Wars (thanks Mr.Mouse!), and I've been looking at the GW.dat file, and I've noticed that some of the unknown files are actually 16-bit Unicode text files. I have no idea how many, but I think all the different language EULAs are among them. Also, I've noticed that on many of the other unknown files, bytes 3 and 4 seem to be 
```
02 01
```
 (IIRC) with some fair consistency.
## Post #128
- Username: lunarman
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Wed Jul 04, 2007 3:30 am
- Post datetime: 2007-07-04T07:54:07+00:00
- Post Title: 

I'm just a casual Guild Wars player but I'm interested in modding this game like I've modded many others. On GwG we've found a new program called Texmod which we've been using for ripping texture out the game, I have a feeling it's not taking actual texture files though instead it is just making a new file based on the data it sees ingame.

[http://www.guildwarsguru.com/forum/show ... t=10173288](http://www.guildwarsguru.com/forum/showthread.php?goto=newpost&t=10173288)
is the first page. Sadly we can only modify textures and I'm hoping to move onto models. From what I understand of what you guys here have been saying: you've got a decompressor but no recompressor (so any modifications made can't be seen in game). I've downloaded the decompressor but can't use it (i'm the kinda person that needs a tut).

Anyway, thankyou. I'll be keeping an eye on things here
## Post #129
- Username: SiENcE
- Rank: beginner
- Number of posts: 29
- Joined date: Wed Jun 13, 2007 3:41 pm
- Post datetime: 2007-07-04T09:18:03+00:00
- Post Title: 

hi,

i just mentioned it in another thread here.

search in google for: Iris2 UO

We have coded a granny v1 loader for our Iris2 (Ultima Online 3D-Client). Maybe it helps. But i think, GW uses Granny V2. Granny V1 differs from the current Granny V2 very much. Also Granny V2 don't prescribe developers how to save a granny. The fileformat can be changes from the developers. So don't expect, that a Granny V2 loader loads all Grannys.

You can use their Grannyviewer from the RAD site to take a look into the Fileformat. It shows the structure and the Datatypes. Take a look, but the current version 2 is very complex.

regards
## Post #130
- Username: nobodyreally
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Wed May 16, 2007 4:30 pm
- Post datetime: 2007-07-18T14:00:46+00:00
- Post Title: 

It would seem to be Granny [http://www.radgametools.com/granny/customers.html#games](http://www.radgametools.com/granny/customers.html#games)
## Post #131
- Username: SiENcE
- Rank: beginner
- Number of posts: 29
- Joined date: Wed Jun 13, 2007 3:41 pm
- Post datetime: 2007-07-18T15:43:03+00:00
- Post Title: 

@SiENcE: what do you think, i'm talking about  !?
## Post #132
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-08-17T14:40:36+00:00
- Post Title: 

Alright.

I'm back to working on this.  Hopefully I'll have some more stuff soon.

BD
## Post #133
- Username: SiENcE
- Rank: beginner
- Number of posts: 29
- Joined date: Wed Jun 13, 2007 3:41 pm
- Post datetime: 2007-08-30T12:48:24+00:00
- Post Title: 

Do you work on decoding Granny V2 meshes? (*.gr2)
## Post #134
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-08-30T13:31:58+00:00
- Post Title: 

I'm working on several things.  First, how GW determines what files to load and second, the format of the ffna files.  There are different types, depending on what data is contained in them.

As far as I can tell right now, it looks like they ARE using a custom format for thier modeld, but don't hold me to that yet.

But the model data doesn't look the same as the test granny data I've worked with.

BD
## Post #135
- Username: AnonAMouse
- Rank: n00b
- Number of posts: 10
- Joined date: Mon Jan 15, 2007 8:30 pm
- Post datetime: 2007-09-07T22:20:54+00:00
- Post Title: 

Found a very interesting zip file here: [ftp://ftp.plaync.com/Source/XDeltaWithNCsoftMods1.zip](ftp://ftp.plaync.com/Source/XDeltaWithNCsoftMods1.zip)
This seems to contain information on all of NCSoft compression techniques, hope this is useful to some people.
## Post #136
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-09-11T17:39:36+00:00
- Post Title: 

Is there any way someone can take the source for the decompressor  and add the code to it that loads and parses the hash table?

It would be useful for what I am working on right now. I had code that did it in C# but lost the source.

If anyone could add the hash processing I would be grateful.

BD
## Post #137
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-09-23T19:34:21+00:00
- Post Title: 

I might still have your C# code for that (as least I think I do, it's been a while ). I'm fairly busy at the moment, but if I find some free time I'll take a look at it and if possible add it to my tool if that would help you.
## Post #138
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-10-08T14:27:20+00:00
- Post Title: 

That would be great.

I've got code written that parses the ffna file, but it doesn't work 100% yet.

It's in c++ this time 

But I am making progress when I get time.

BD
## Post #139
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-10-08T19:04:22+00:00
- Post Title: 

I've uploaded a [new version](http://www.raechaer.de/GWDatBrowser.rar) of my GWDatBrowser (source is included).

It now also displays the hashes, a hash of 0 means that there was no hash for that MTF entry. Some entries also have more than 1 hash, that's why they're listed several times. I'm not quite sure if that's what you wanted and if I actually display the right hashes, but at least the file with hash 3 is still the prefs file, I guess that's a good sign
## Post #140
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-10-09T14:36:59+00:00
- Post Title: 

Cool.  Thanks.  I'll try it when I get home.

BD
## Post #141
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-10-10T00:23:12+00:00
- Post Title: 

That worked.  It'll  make the job easier.  Thanks.

BD
## Post #142
- Username: Darkstar
- Rank: advanced
- Number of posts: 67
- Joined date: Thu Jun 14, 2007 8:14 pm
- Post datetime: 2007-10-11T07:58:24+00:00
- Post Title: 

On my system, the path to GW.EXE is saved in HKLM, not HKCU. Your program should check HKLM if it doesn't find it in HKCU 

And it seems that after some time, the textures don't get displayed properly anymore. I.e. I only see the checkered background. I don't know what causes this, though. I just klicked around for some time. Maybe a problem with transparency in the textures?

Other than that: A great program! I'm currently looking at some FFNA files to see if I can find something interesting.

--Darkstar
## Post #143
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2007-10-11T08:28:57+00:00
- Post Title: 

> Reply from Darkstar
>
> On my system, the path to GW.EXE is saved in HKLM, not HKCU. Your program should check HKLM if it doesn't find it in HKCU
Should be easy enough to add, if I don't forget it it'll be in the next version.

> Reply from Darkstar
>
> And it seems that after some time, the textures don't get displayed properly anymore. I.e. I only see the checkered background. I don't know what causes this, though. I just klicked around for some time. Maybe a problem with transparency in the textures?
Hamm, that's never happened to me. Did it only happened once or does it happen all the time when you click for a while? Maybe I have a resource leak somewhere.

> Reply from Darkstar
>
> Other than that: A great program! I'm currently looking at some FFNA files to see if I can find something interesting.
Thanks  If you (or anybody else) figures out more details about the file formats please tell me and I'll try to add it.
## Post #144
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-10-11T12:59:13+00:00
- Post Title: 

Yeah, I had to add the registry key as well but it was no big deal.

The first ffna file loaded by the game is the ffna file with the hash of 5.  This is why I needed to be able to see the hahes, otherwise it was a pain because they can move around the MFT.

Anyway, as I noted before the ffna files contain "chunks" of data.

The first four bytes are always ffna of course.  The fifth byte is the file type.

The type of the hash file 5 ffna is 4, and seems to be a master file of some-sort.

The model files are all type 2, with different sub-types.  Sub-type 0x0a shows up a lot. 

Type 3 is terrain or map data.  The type can never be greater than 9.  The program throws an exception if it is, so there aren't TOO many types.

For the type 4 "master file" the program does some funky processing.  It reads in one byte at a time and then "hashes" this against a hard-coded table in the exec, then takes this 4-byte value and stores it in a list.  Then creates a new node, etc.  It does this for only a few chunks, which I assume are a header of some-sort.

It's difficult parsing out what this does exactly, but I'm getting through it.

I THINK that these are pointers to other files (maybe for the opening scene) but am still working on it.

BTW.  Some of the "unknown" files are text files that are doubly-compressed.  Meaning that the initial decompression routine we coded uncompresses them once, but then the text appears to be setup in a string table or something.  Just something I noticed when I was looking around.  Haven't worked on it yet.

I'll keep you posted.

BD
## Post #145
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2007-10-17T11:19:17+00:00
- Post Title: 

Hey, I recently started messing around with this stuff (as of yesterday). 

Rather than trying to figure out DAT structure, I wanted to emulate a fileserver client.

You've mentioned that some FFNA's seem to have a list of hashes, "points to other files", I believe this to be true also. Atleast, that being one of it's functions. I'm guessing that it's a dependancies list.

For example, when you go to load a map you've never been to in GW, the client asks the server for a list of files. One of the best ways to do that would be to download the "map" file, read the dependancies list and then request all of those hashes.

Just a guess atm, I will try to figure more out.
## Post #146
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-10-17T12:40:28+00:00
- Post Title: 

Before the first ffna file is loaded, the program loads two other files one which is called a "dependency" file and the other is a "composite file".  One of them is hash 1001, and the other is has 0x33ea.  1001 seems to contains the same data as the hash table, so it is probably used to check number of files against the server, or possibly this file has a "version number" and if it is different it gets the new data from the server.  The first file downloaded when something changes is the executable itself I think.  It is stored in the gw.dat as file number 1002.  Then it gets fired off again and dl's the new files.  33ea may also contain numbers or "pointers" to other files for dependencies.  I never messed with it much yet.

BD
## Post #147
- Username: decompiler
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Sat Oct 20, 2007 6:12 am
- Post datetime: 2007-10-21T22:28:57+00:00
- Post Title: 

a few suggestions for the program:
a filter
With sounds, add a column quality OR check the quality of every file and only keep the highest quality

For the rest, keep on with such a good program.
## Post #148
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2007-10-24T03:37:46+00:00
- Post Title: 

> Reply from BlackDragon
>
> Before the first ffna file is loaded, the program loads two other files one which is called a "dependency" file and the other is a "composite file".  One of them is hash 1001, and the other is has 0x33ea.  1001 seems to contains the same data as the hash table, so it is probably used to check number of files against the server, or possibly this file has a "version number" and if it is different it gets the new data from the server.  The first file downloaded when something changes is the executable itself I think.  It is stored in the gw.dat as file number 1002.  Then it gets fired off again and dl's the new files.  33ea may also contain numbers or "pointers" to other files for dependencies.  I never messed with it much yet.

BD

I've made a fileserver client now, which is giving me a better understanding of some of the files purposes / the format.

0x1002 is an executable, which acts as a patcher for the game. I think when it's executed, it actually writes the full GW excutable to the DAT. (Which is the one you'll see with the unpacker)

The full GW executable can be downloaded at "various hashes". The program has data packed on to the end of it, no idea why this is yet...

The "various hashes" seem to increment with each new guild wars build, as does the dependancy file. The dependancy file might be the same at every hash, but increments tell the GW client to download a new one. Kinda like it's an alias hash for a real file hash. ;x

The dependancy file is compressed (the first in the DAT). It's quite large and contains all file hashes I believe. The hashes the client currently contains is what Mtf entry #3 points at.

I'll probably write a DAT writer for my fileserver client, might get some speedier downloads out of it =). I just find it fun really ;o
## Post #149
- Username: Darkstar
- Rank: advanced
- Number of posts: 67
- Joined date: Thu Jun 14, 2007 8:14 pm
- Post datetime: 2007-10-24T09:49:13+00:00
- Post Title: 

Hmm maybe I'm the only one who didn't get it, but...

...could you describe what you mean by "fileserver client"? Did you write a program which downloads files by hash from the official server? Does that mean that you've deciphered the encryption used in the network protocol? Is any of this stuff/information available somewhere already? (Yes I know of the GWLP project, but that was closed source and seems to have disappeared lately)

I'm really interested in how the network protocol for GW works...

--Darkstar
## Post #150
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2007-10-24T11:30:25+00:00
- Post Title: 

> Reply from Darkstar
>
> Hmm maybe I'm the only one who didn't get it, but...

...could you describe what you mean by "fileserver client"? Did you write a program which downloads files by hash from the official server? Does that mean that you've deciphered the encryption used in the network protocol? Is any of this stuff/information available somewhere already? (Yes I know of the GWLP project, but that was closed source and seems to have disappeared lately)

I'm really interested in how the network protocol for GW works...

--Darkstar

Yeah, I request files from the server. The GWLP Project hasn't disappeared and I am a staff member, I rarely program for the Login/Game server though. The fileserver was never much of an interest to us, but I got bored a few day's ago and thought I'd write a client.

The GWLP Project is closed source, mainly because it uses encryption (we don't want people exploiting official servers etc.).

But the fileserver isn't encrypted - and I see no reason to keep the protocol specs closed (especially how simple it is), so I will probably release the information soonish 

As for other protocols... you're on your own =(
## Post #151
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2007-10-24T13:33:34+00:00
- Post Title: 

Wow.  Good work on this.  For some reason, I'd never ran across this project before or I could've helped you guys out.

Oh well.

Do you by any chance have any of the ffna file specs figured out?  Could you explain how the "hashes" work?  I'll bet that is part of the code that was confusing me.  Is that why they loop certain variables byte-by-byte against a table in the exec?

BD
## Post #152
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2007-10-24T16:14:40+00:00
- Post Title: 

> Reply from BlackDragon
>
> Wow.  Good work on this.  For some reason, I'd never ran across this project before or I could've helped you guys out.

Oh well.

Do you by any chance have any of the ffna file specs figured out?  Could you explain how the "hashes" work?  I'll bet that is part of the code that was confusing me.  Is that why they loop certain variables byte-by-byte against a table in the exec?

BD

We have no information about the FFNA files at the moment =( As somebody has suggested in the past, the model files probably use Granny v2 format, I've compared the formats (the Granny website has some models you can download with their demo package) and the formats don't look identical, but then again two granny 3d files didnt look the same at all either.

The only thing that looked the same out of two different granny 3d files was the version number. Everything else is probably compressed, hence no structure looks the same.

As for hashes... theres not much to say. There's a hash for each file, I don't think its based on the files content or filename. I don't think we should even be calling them hashes, they're just unique identifiers, and as i said in my previous post, a unique identifier can have a alias identifer (points to the same file) which just makes GW want to update the file (because it doesn't have it).

The byte to byte lookup is probably comparing what the client has and hasn't got.

Hopefully we can do some trial by error, our emulator can load up any map we want (it just uses the hash - Bah, can we start calling it a unique id?!). Using your extractor I managed to get a few "dev maps" from the DAT file (no idea why they are there!). If i can now make a DAT writer and keep editing a map file we can:

a) see if it loads and spot differences or ...
b) see what lovely, detailed error dump GW gives us back.

We don't have a compressor, and I can't get my head around huffman... so maybe a flag that tells GW the file isn't compressed will do the job.

It might also be interesting to do some map swapping... Halloween Lions arch all year around? Why not!
## Post #153
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2007-10-24T16:21:27+00:00
- Post Title: 

> Reply from saracen
>
> 
We don't have a compressor, and I can't get my head around huffman... so maybe a flag that tells GW the file isn't compressed will do the job.

Oh, and just to add... if that works, a DAT decompressor and saver might be handy for some people. Some people assume that -image decompresses the files in their DAT file... I haven't seen that happen yet - it just gets all the files from the server.

If we can do the flag trick, and decompress everything (resulting in a large file!) it might get some faster load times. Who knows.

(Showoff: Not that my computer needs faster load times, I'm not running Guild Wars on a GameBoy)
## Post #154
- Username: Darkstar
- Rank: advanced
- Number of posts: 67
- Joined date: Thu Jun 14, 2007 8:14 pm
- Post datetime: 2007-10-24T19:11:36+00:00
- Post Title: 

> Reply from saracen
>
> Yeah, I request files from the server. The GWLP Project hasn't disappeared and I am a staff member, I rarely program for the Login/Game server though. The fileserver was never much of an interest to us, but I got bored a few day's ago and thought I'd write a client.
Glad to hear you guys are still around. Have any new (public) website/forum?

> Reply from saracen
>
> The GWLP Project is closed source, mainly because it uses encryption (we don't want people exploiting official servers etc.)

But the fileserver isn't encrypted - and I see no reason to keep the protocol specs closed (especially how simple it is), so I will probably release the information soonish 

As for other protocols... you're on your own =(
Yes, I figured as much. Sad to hear, but I still have the hope that someday, an open source project will emerge from the depths of the internet ^^ It would be a shame if what happened to Auto Duel would also happen to GW in a year or two...
## Post #155
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2007-10-24T20:37:46+00:00
- Post Title: 

> Reply from Darkstar
>
> Have any new (public) website/forum?
[http://gwlp.mgcorp.org/](http://gwlp.mgcorp.org/)

We're mainly on IRC: irc.rizon.net / #gwlp

> Reply from Darkstar
>
> sad to hear, but I still have the hope that someday, an open source project will emerge from the depths of the internet ^^ It would be a shame if what happened to Auto Duel would also happen to GW in a year or two...

I have no idea what happened to Auto Duel, but if Arenanet had to close its servers for whatever reason, then we'd probably release the protocol specifications. We're not against sharing, we just don't like the idea of bot makers going wild and people attempting more exploits (hint: GW isn't very good at unexpected user input =()
## Post #156
- Username: db.
- Rank: beginner
- Number of posts: 21
- Joined date: Wed Oct 10, 2007 10:12 am
- Post datetime: 2007-10-25T15:11:14+00:00
- Post Title: 

> Reply from saracen
>
> Darkstar wrote:Have any new (public) website/forum?
http://gwlp.mgcorp.org/

We're mainly on IRC: irc.rizon.net / #gwlp
Darkstar wrote:sad to hear, but I still have the hope that someday, an open source project will emerge from the depths of the internet ^^ It would be a shame if what happened to Auto Duel would also happen to GW in a year or two...

I have no idea what happened to Auto Duel, but if Arenanet had to close its servers for whatever reason, then we'd probably release the protocol specifications. We're not against sharing, we just don't like the idea of bot makers going wild and people attempting more exploits (hint: GW isn't very good at unexpected user input =()

it doesnt like derv's either ... or did you get that part fixed already lol.
## Post #157
- Username: lej
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sun Nov 04, 2007 1:08 pm
- Post datetime: 2007-11-15T08:06:03+00:00
- Post Title: 

Contrary to Saracen's earlier statement a file server has become necessary to the GWLP so we wrote one. I think it may be of use to the people working on the data archive format. 

> The GWLP file server implements the Guild Wars file transfer protocol which is used officially for updating the game. This software is interoperable with the official Guild Wars game client. It can be used for placing custom files in the gw.dat, downgrading/upgrading a Guild Wars installation to a particular version, and modifying existing files. 

You can download the server installation package here: [http://www.mediafire.com/?5s9byyeho7d](http://www.mediafire.com/?5s9byyeho7d)  EDIT: (Fixed a major bug)

For more information and support visit: [http://gwlp.mgcorp.org/forums/viewtopic.php?t=23](http://gwlp.mgcorp.org/forums/viewtopic.php?t=23)

Also, the FFNA files the client expects from the file server differ from the FFNA files stored in the data archive. Both in size and content. It seems to me that they have sections that are compressed. I've attached FFNA files compressed from Anet's servers, decompressed from Anet's servers, and from dat to this post if anyone is interested.
[FFNA Files.rar](https://xentaxbackup.github.io/file/1393_FFNA Files.rar)
## Post #158
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2007-11-15T13:52:31+00:00
- Post Title: 

> Reply from lej
>
> Also, the FFNA files the client expects from the file server differ from the FFNA files stored in the data archive. Both in size and content. It seems to me that they have sections that are compressed. I've attached FFNA files compressed from Anet's servers, decompressed from Anet's servers, and from dat to this post if anyone is interested.

I hadn't had time to look, but i just did so now and it seems very easy to figure out. So there will probably be an update soonish.

On another note, i would just like to mention that i was eating an egg sandwich while writing this, and the egg just slipped out and went down my sleeve. 

The moral of the story being: l3j, stop posting incomplete stuff and give me a second to have a break from work to look at simple file formats.
## Post #159
- Username: tobias
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Wed Jan 23, 2008 2:26 pm
- Post datetime: 2008-01-23T16:30:21+00:00
- Post Title: 

First of all, thanks to everyone here for the progress they've made on this.

I've been using Irina's Dat Browser program to browse through the .dat file, specifically at the image and sound files.  Unfortunately, the program's a little unwieldy, due to a lack of search functions and being able to only export one file at a time.  Being able to dump everything into a Windows folder and browse it there would work a lot better for me.

I saw BoyC's Unpacker program on the XeNTaX wiki:

> Reply from BoyC
>
> Hi guys, the "anonymus" coder here

http://digitaldynamite.demoscene.hu/pri ... packer.zip

Unfortunately, I'm not sure how to use it (running the .exe opens the program for a split second and then closes it), and as the Wiki entry states I wouldn't know what to do with it if I did get it running, since I don't know how to use command line programs.  And given the wiki page is half a year old, I'm not expecting a user-friendly version or a how-to guide any time soon.

Is there anyone here who could explain how to use the Unpacker to dump all the files from the .dat file, or failing that, through some other means that's simpler than right-click -> saving every file individually?

Apologies for this being a noob question in an otherwise intelligent discussion, there's really not many other people so far that have been fooling around with this stuff.
## Post #160
- Username: Darkfox
- Rank: VVIP member
- Number of posts: 688
- Joined date: Sat Jul 05, 2003 1:11 am
- Post datetime: 2008-01-23T18:06:57+00:00
- Post Title: 

Guess you would have had to have grown up with DOS. Let me explain...

Usually a command line unpacking tool is ran by putting it in the same folder as the file you want to unpack. Usually it is done like this:

Toolname.exe [name of file you want unpacked]

replacing the thing in the brackets with the name of the file you want unpacked. You could also accomplish this by dragging the .dat file over the program and dropping it (unclicking it) and some programs run this way as well.
## Post #161
- Username: tobias
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Wed Jan 23, 2008 2:26 pm
- Post datetime: 2008-01-23T18:30:00+00:00
- Post Title: 

Well, dragging the .dat file onto the unpacker works... but all it does is spit out some information about the file (number of entries, etc) and then closes after about a second.  It doesn't seem to unpack any files when it runs.
## Post #162
- Username: Darkfox
- Rank: VVIP member
- Number of posts: 688
- Joined date: Sat Jul 05, 2003 1:11 am
- Post datetime: 2008-01-23T18:31:59+00:00
- Post Title: 

Then it seems it requires an output desination if it unpacks nothing.
## Post #163
- Username: tobias
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Wed Jan 23, 2008 2:26 pm
- Post datetime: 2008-01-23T18:37:36+00:00
- Post Title: 

How would I assign a destination, then?
## Post #164
- Username: Darkfox
- Rank: VVIP member
- Number of posts: 688
- Joined date: Sat Jul 05, 2003 1:11 am
- Post datetime: 2008-01-23T19:00:24+00:00
- Post Title: 

Likely with a third option like "C:\GWOutput"

But I don't know this program. For all I know it could be as simple as a missing option.
## Post #165
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2008-01-26T17:31:46+00:00
- Post Title: 

Tobias, I'm assuming you're not trying to run the unpacker from within DOS? If not, you can open up a DOS session by clicking Start -> Run... and running cmd (if that doesn't work, try command). When you get the session running, you should navigate to the folder where you saved the unpacker exe (type in cd "full directory"). From there, type in the unpacker filename followed by /?, for instance, gw_unpacker /?. This should spit out some text. Copy the text and post it here and I'll be able to help you further.

If any of that didn't make sense, blame me and feel free to ask for a clarification.
## Post #166
- Username: Ravious
- Rank: ultra-n00b
- Number of posts: 5
- Joined date: Tue May 01, 2007 11:11 pm
- Post datetime: 2008-02-01T13:41:58+00:00
- Post Title: 

Has anyone been trying to crack the 3d format?
## Post #167
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-02-01T15:02:32+00:00
- Post Title: 

I was looking at it, but I got side-tracked by the GWLP and have been looking at that code instead, because if I can force the client to load whatever map I want with the GWLP code then I don't need to do a map viewer.

BD
## Post #168
- Username: Ravious
- Rank: ultra-n00b
- Number of posts: 5
- Joined date: Tue May 01, 2007 11:11 pm
- Post datetime: 2008-02-01T15:06:58+00:00
- Post Title: 

Cool!  I guess my main hope is to get a model viewer that can export the model and textures...

But, a map viewer in whatever form would be great!
## Post #169
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-02-01T16:15:37+00:00
- Post Title: 

One of the things that hampers me a bit is that I've never done 3d coding in Directx, only OpenGL.

Since GW uses DirectX, it's a little harder for me because I'm not familiar with the layouts and such, and have only a rudimentary understanding of shaders and so on.

However, I guess I could just decode the file format and let others take a look at it.

BD
## Post #170
- Username: Brother
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Sat Feb 02, 2008 2:53 am
- Post datetime: 2008-02-01T21:48:50+00:00
- Post Title: 

I've been doing some poking and prodding an discovered that a lot of the "Unknown" file types actually look like raw structs serialized to a flat file.

Interestingly, this includes a lot of the string structs in the game. Sadly, I haven't found a surefire way of determining 100% that the file is one of these data files outside of brute forcing it.

It would appear that a format of:
struct
{
  USHORT size;
  USHORT flag1;
  USHORT flag2;
  BYTE* data;
}

is used, where flag2 = 0x10 for strings.

Also, the last 2 bytes of the files seem to be flags where the last byte is a file counter and the second to last byte is a language code:

Ex: 00 01 (English, File 0)
Ex: 01 01 (Korean, File 0)
etc..

(I know that this leaves them with 256 files per language, but they are only up to 0x4A so they have room to spare)

So, I've written up some code that looks for these structs and then 0x10 string structs and dumps them all out to a nice ASCII formatted txt file. A little STL set magic and I've removed duplicates strings, and by checking the language flag seperate out English text from other languages.

In any case, it seems like theres lots of other data-types mixed in with the text. Specifically flag2 0x07 and 0x06 show up quite a lot with flag1 varying. I have no idea what those flags are though.

Additionally, I've been saving all the CRCs out to a crc.dat file and then compare CRCs between versions so I know which files have changed between builds.

I'm curious as to who is maintaining source for this so we can get my code included in the "latest" build.

Lastly, has anyone made progress on the ATEXDXTA file types? Just from a little bit of mucking around it looks like DXT5 compressed with only the Alpha channel?
## Post #171
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-02-02T17:14:31+00:00
- Post Title: 

Hi Brother,
     If you look further back in the thread you'll see a message that has the source code in it.

There are several of them, use the last one that shows up.

I don't have anywhere to host code myself.

BD
## Post #172
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2008-02-25T09:54:35+00:00
- Post Title: 

> Reply from Brother
>
> I'm curious as to who is maintaining source for this so we can get my code included in the "latest" build.
If you're talking about the GWDatBrowser then that would be me, although I didn't "maintain" it a lot lately since I was busy with other things 

The latest source should still be at [http://www.raechaer.de/GWDatBrowser.rar](http://www.raechaer.de/GWDatBrowser.rar). If you (still, I know I'm kinda late ) want to add your code to it I'd appreciate it if you didn't distribute the modified version yourself but instead send it back to me to not confuse people with different version from different people.
## Post #173
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-03-30T14:16:24+00:00
- Post Title: 

Does anyone happen to have a copy of the GWLP (Guild Wars Lan Project) code?  I re-formatted my computer (well, actually GPartD screwed up my Vista partition) and I lost the code and thier site seems to be down.

I was using it for a map viewer so I didn't have to figure out a bunch more of these GW file types.

BD
## Post #174
- Username: Darkstar
- Rank: advanced
- Number of posts: 67
- Joined date: Thu Jun 14, 2007 8:14 pm
- Post datetime: 2008-04-01T19:46:20+00:00
- Post Title: 

I was under the impression that GWLP is (was?) closed source?
## Post #175
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-04-02T13:06:10+00:00
- Post Title: 

It was closed source orginally, but then they oopened it up sometime around Xmas.  

But the site doesn't have code on it anymore.  Oh well.  Back to the drawing board I guess 

BD
## Post #176
- Username: Darkstar
- Rank: advanced
- Number of posts: 67
- Joined date: Thu Jun 14, 2007 8:14 pm
- Post datetime: 2008-04-04T15:13:28+00:00
- Post Title: 

Damn I missed the "open-source window" 

If anyone has gotten the source code back then, please speak up, I'm really interested in it, too 

-Darkstar
## Post #177
- Username: lej
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sun Nov 04, 2007 1:08 pm
- Post datetime: 2008-04-12T08:13:27+00:00
- Post Title: 

The contents of this post was deleted because of possible forum rules violation.
## Post #178
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-05-08T13:16:15+00:00
- Post Title: 

Got a question.

Looking at some of the update notes ANet keeps talking about closing "exploits", like hidden outposts and party-size and whatnot.

Someone has to be hacking the client to make these happen.  Anyone know WHO is doing this?  What groups or people?

I could care less about game exploits (I don't even play anymore), but WOULD be willing to talk with these people to see what all they know.

BD
## Post #179
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2008-05-11T00:04:57+00:00
- Post Title: 

Pablo, one of the members we kicked from GWLP for exploiting the official servers is the one in to all of that.

It isn't particularly difficult, it just takes time to understand the underlying network protocol, which was obviously something we were doing. I suppose ArenaNet didn't think people would be able to do it so easily (well, tbh, only a handful can). But it's something they should have been preventing from the start. Web Developers especially know this -- CHECK USER INPUT.

I haven't touched Guild Wars or GWLP for a long time now. I can't remember much about it anymore =).

We did have the ability to load any map we wanted, but this would take a lot of time to do now, as the opcodes change with each GW release.

I also did some research on FFNAs, which are simply just an archive. Map data for one map is usually stored in one FFNA, which includes different data blocks (files really, as it's part of the archive). I couldn't make much sense of it. I even discovered a few GW development maps, 0ne of which was just a flat plane - still couldn't figure the format even with that! =)

But, I've pretty much given up. Like I said, I haven't touched it. I think there will be a few of us (that have became bored, and moved on) that will come back for the release of GW2 - to see if anything is fun/similar (they we have a head start =)).

irc.rizon.net - #gwlp
You might find Pablo on that channel. Keep in mind he is about 14 years old and an idiot. But (he's an idiot) i'll (he's an idiot) let (he's an idiot) you (he's an idiot) decide (he's an idiot) for (he's an idiot) yourself.

Have fun =)
## Post #180
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-05-11T00:41:51+00:00
- Post Title: 

LOL.

Thanks for all of that info Saracen.

I have no intention of chatting with a 14-year old.

I remember when your project first went live that ANet said that as long as it didn't allow piracy then they were ok with it.

Too bad Pablo did all that.

Oh well.

BD
## Post #181
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-09-03T13:26:06+00:00
- Post Title: Re: Guild Wars .DAT File

I started working on this again and have made some progress.  I hope to have some specs/file formats for the various ffna types soon.

BD
## Post #182
- Username: BoyC
- Rank: beginner
- Number of posts: 36
- Joined date: Thu Jul 06, 2006 4:24 am
- Post datetime: 2008-09-03T15:11:54+00:00
- Post Title: Re: Guild Wars .DAT File

Nice to know you're still at it! I'm too swamped in work to look into this again... maybe after the first gw2 beta
## Post #183
- Username: Irina
- Rank: beginner
- Number of posts: 22
- Joined date: Sat Feb 24, 2007 8:21 pm
- Post datetime: 2008-09-03T15:55:33+00:00
- Post Title: Re: Guild Wars .DAT File

Great to see you're still working on it  If you find out how to decode the files (and if I have time) I'd love to add it to the GWDatBrowser .
## Post #184
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-09-12T13:42:24+00:00
- Post Title: Re: Guild Wars .DAT File

You know...It's funny.  There haven't been many updates to GW in a while now, but the minute I start working on this again, we get updates out the whazoo, thus destroying all my breakpoints and scrambling all the adresses 

Hey Anet, if you read this, just give us the file formats already!  

BD
## Post #185
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2008-09-16T13:59:55+00:00
- Post Title: Re: Guild Wars .DAT File

> Reply from BlackDragon
>
> I started working on this again and have made some progress.  I hope to have some specs/file formats for the various ffna types soon.

BD

Hopefully, like me, you found that the ffna does just contain different files, it's an archive in itself. Or at the very least, has different sections.

In fact, I may have already mentioned that here - but I can't be bothered to read back on everything 

Anyway, I can't remember the exact format, but it was something like this:

```
  4 bytes - Unknown.
  unsigned int - Length
  unsigned int - Position

```


I believe the entries were linear. for example:

Read "FFNA" and 1 character (indicates the FFNA type), then read in an Entry Header. After you've jumped to it's position and read it's length - your file pointer should already be at the next entry. So just keep reading.
## Post #186
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-09-17T13:12:30+00:00
- Post Title: Re: Guild Wars .DAT File

Yeah, I found that out already.  Some of the data is also doubly-processed: Not only is it compressed, but even after you uncompress it it STILL needs processing done on it to make it useful.

The first ffna file read in is type 4, which seems to have to do with the MOTD.  It goes through a lot of processing before it is even useable.  The type of 2 (with a subtype) are the model files, type 3 are map files and there are other misc. types.

Anyway, after the type-4 file is loded in and decompressed they run it through ANOTHER decompression routine to build what I think is a lookup table for text; might not be, might just be text itself but I think it is a dictionary.  You can actually clear out that entire file, leaving only the headers, and all that will be missing is the MOTD 

Because Anet seems to use custom formats for everything it makes it take a little longer but we'll get there soon, as long as real-life doesn't intrude too much  

BD
## Post #187
- Username: saracen
- Rank: n00b
- Number of posts: 10
- Joined date: Wed Oct 17, 2007 9:26 am
- Post datetime: 2008-09-22T14:45:58+00:00
- Post Title: Re: Guild Wars .DAT File

From a networking point of view, the MOTD is handled differently, in that I think it's the only compressed data sent from the login server rather than the file server.

When I captured it while it streamed in (I never found it in the DAT) it wasn't compressed multiple times, however it does obviously require a parser. I believe it was a XML derived format - it also sends ALL languages (or atleast it used to) - So make sure you don't comfuse the unicode as binary data for compression or whatever.

They do have a commonly used string table I believe and you'll probably come across arguments in strings where they're supposed to be. For example: "Hello %str%", where %str% would then get replaced with some common string they have saved (or even your current characters name). Sort of like printf.
## Post #188
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-10-11T15:20:20+00:00
- Post Title: Re: Guild Wars .DAT File

I think I posted this before so forgive me if I did, but I don't remember...Darn old age (

Anyway, what debuggers are you guys using?  I use OllyDBG and it seems to have trouble with locking-up when GW threads something out and this is starting to irritate me.

Anyone have any other recommendations?

BD
## Post #189
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-11-11T21:13:00+00:00
- Post Title: Re: Guild Wars .DAT File

OK.  Been doing more work on this and I'm actually beginning to figure out the ffna file format, although it is rather complicated.

Here's what I know:

Each ffna stores data in chunks.  The header for the ffna goes like this:

4 bytes spelling out ffna.

One byte that tells the type (02 is a model file).

Then 4 bytes that contain the chunk type, then 4 bytes that contain the chunk size.

The first model file loaded in is hash 0x497cf (from GwDatBrowser).  I'm assuming this has to do with the opening scene.  

The mdlLoad.cpp (ModelLoad.cpp) section of the gw code starts looking at the ffna by chunk types, and breaks down the data into separate arrays.

It first looks for chunk type 0x0fa6.  There is one in the file that is size of 0x0a, and contains the bytes "0x01049ccd".

Then it looks for type 0x0fA8 and 0x0fAe, neither of which exist.

Then it looks for 0x0fA1, which seems to be a major type because it goes into lots of processing as it seems this type has several subheaders in it.  I'm not going into the pseudocode yet.

Anyway, you can read in all the chunks and start looking at the data this way.  There is some text in there, about y.spec and perturb and such.

We are getting closer.  Soon I'll have the types actually figured out (whether they are meshes or whatnot).  I'd think there would be texture lookups in there too.  I'll keep you posted.

BD
## Post #190
- Username: mqstout
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Wed May 09, 2007 10:39 am
- Post datetime: 2008-11-12T01:49:08+00:00
- Post Title: Re: Guild Wars .DAT File

I'm still wondering if bribery would help keep those gears grinding?
## Post #191
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2008-12-20T15:55:26+00:00
- Post Title: Re: Guild Wars .DAT File

I've been busy playing "Wrath of the Lich King" and "LOTRO:Mines of Moria" and "Warhammer Online"   

When I get max level in those, I'll be back to this project 

BD
## Post #192
- Username: RavynousHunter
- Rank: n00b
- Number of posts: 17
- Joined date: Mon Apr 07, 2008 6:00 pm
- Post datetime: 2009-03-13T08:49:48+00:00
- Post Title: Re: Guild Wars .DAT File

Not sure if this is useful or not, but Guild Wars Wiki has an entry on the [GW.dat file format.](http://wiki.guildwars.com/wiki/Gw.dat_file_format)
## Post #193
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2009-03-13T16:32:19+00:00
- Post Title: Re: Guild Wars .DAT File

It seems to be largely a edited copy of our own [wiki page](http://wiki.xentax.com/index.php?title=Guild Wars DAT), judging by the discussion on its talk page.
## Post #194
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2009-03-13T19:33:40+00:00
- Post Title: Re: Guild Wars .DAT File

Nice find, Dinoguy!!!!! I'm glad to see he now credits our work on the format.  Thanks for sticking up for us, pal
## Post #195
- Username: Dinoguy1000
- Rank: Site Admin
- Number of posts: 786
- Joined date: Mon Sep 13, 2004 8:55 am
- Post datetime: 2009-03-14T14:55:20+00:00
- Post Title: Re: Guild Wars .DAT File

Yep, no problem.
## Post #196
- Username: RavynousHunter
- Rank: n00b
- Number of posts: 17
- Joined date: Mon Apr 07, 2008 6:00 pm
- Post datetime: 2009-03-20T14:59:06+00:00
- Post Title: Re: Guild Wars .DAT File

Huh...  Didn't notice that until I took a closer look...  My attentiveness seems to take a hit after 2am.
## Post #197
- Username: FurryFan
- Rank: mega-veteran
- Number of posts: 190
- Joined date: Sun Jan 10, 2010 4:37 am
- Post datetime: 2010-01-09T23:05:30+00:00
- Post Title: Re: Guild Wars .DAT File

> Reply from Ravious
>
> Has anyone been trying to crack the 3d format?
Yes, in the sample FFNA files that were posted there is a 3d model in it.
The two files both contain a Legs wearing high heels apparently. However the file from the Server is smaller but still has the same base mesh and 4byte float Vertexes, but its, Normal mapping, And texture Mappings appear to be signed Integers not floating points at the end of the file. The FFNA file from the data file has regular 4byte floats for textures and normals. Here are pictures:


Using signed binary integers as textures coordinates is something that mostly really old pre-2000 computer games use, so I suggest that this mesh, is just a low Lod mesh used when they are a lot of meshes on screen.
## Post #198
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2010-01-10T17:35:35+00:00
- Post Title: Re: Guild Wars .DAT File

Hey, nice find.  I haven't looked at this in ages but maybe we can get a little close now huh?

What file was it?  What were the header bytes?

BD
## Post #199
- Username: FurryFan
- Rank: mega-veteran
- Number of posts: 190
- Joined date: Sun Jan 10, 2010 4:37 am
- Post datetime: 2010-01-10T20:00:22+00:00
- Post Title: Re: Guild Wars .DAT File

> Reply from BlackDragon
>
> Hey, nice find.  I haven't looked at this in ages but maybe we can get a little close now huh?

What file was it?  What were the header bytes?

BD
"Lej" posted it way back on page 11, in 2007, The files are at
[download/file.php?id=1393](http://forum.xentax.com/download/file.php?id=1393)

It is just 3 different versions of file "50584".
The smaller decompressed version from the sever begins with:
(66 66 6E) [ffna]
(02 B8 0B 00 00 2F 18 00 00 26 00 00)
(00 00 00 00 00 09 01 00 00)
(F0 95 B2 D6 88 15 B8 6C 00 00 00 00 00)

The "26" probably almost certainly refers to the real beginning of the file, because the rest of the file matches up with it especially if you display 24 bytes in each row in the hex editor.
Then there are some unknown bytes and the floats, 
.6999999999 and 1.79999999 which are almost exact fractions probably a scaling factor.
Then more unknown bytes followed by (E2 02) [738 in decimal]
which is the number of bytes in the face list, however the face does not begin until 0X24 bits later.
Face list is:
[Vertex#1, Vertex#2, Vertex#3]
Then without a break the Vertex list
Followed by some type of Normal and texture mapping. It might by compressed but there is still a slight pattern: when looked at in rows of 24, some rows have only values higher than C0, while other rows contain values only smaller than 80.
Next in the file are two (DXT?) textures, which both begin with the text "ATEXDXT"

The bigger file from the guild wars data file, does not have actual  textures, but does have Normal and Texture mapping, also the Face list begins 0x32 bytes after the bytes that show how long it is and the header is:
(02 A0 0F 00 00 F5 2C....) after the text "ffna"
I need more files to test, the decompressers posted give me an error message when I start them up on my dat file.
## Post #200
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2010-01-11T15:20:21+00:00
- Post Title: Re: Guild Wars .DAT File

I still have the source here.  What is the error you are getting?  What OS are you using?

BD
## Post #201
- Username: FurryFan
- Rank: mega-veteran
- Number of posts: 190
- Joined date: Sun Jan 10, 2010 4:37 am
- Post datetime: 2010-01-12T23:33:17+00:00
- Post Title: Re: Guild Wars .DAT File

> Reply from BlackDragon
>
> I still have the source here.  What is the error you are getting?  What OS are you using?

BD
I got a different decompression program to work. Thanks for asking though.
## Post #202
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2010-03-18T13:01:33+00:00
- Post Title: Re: Guild Wars .DAT File

> Reply from FurryFan
>
> BlackDragon wrote:I still have the source here.  What is the error you are getting?  What OS are you using?

BD
I got a different decompression program to work. Thanks for asking though.

Anyone done anymore work on this?  Or should I dust off my debugger 

--BD
## Post #203
- Username: mqstout
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Wed May 09, 2007 10:39 am
- Post datetime: 2010-03-18T16:28:51+00:00
- Post Title: Re: Guild Wars .DAT File

What do I have to do to convince you to dust off your debugger?
## Post #204
- Username: FurryFan
- Rank: mega-veteran
- Number of posts: 190
- Joined date: Sun Jan 10, 2010 4:37 am
- Post datetime: 2010-03-18T17:46:10+00:00
- Post Title: Re: Guild Wars .DAT File

> Reply from BlackDragon
>
> FurryFan wrote:BlackDragon wrote:I still have the source here.  What is the error you are getting?  What OS are you using?

BD
I got a different decompression program to work. Thanks for asking though.

Anyone done anymore work on this?  Or should I dust off my debugger 

--BD

What I did was use the ATEX (guild wars texture format) converter that someone else wrote, and match the mesh files up that have similar file numbers, it worked for a bird model, and some others but not every mesh had a similar number to the mesh's texture.

I think that we can get file names/hashes from Guild Wars RAM when the game is running. For example you could do a pointer search for a NPC's name that is on screen, and see what model file number is pointing to the NPC's name. However the program "Cheat Engine" won't attach to the guild wars process, even if disconnect the internet first.

BlackDragon, you wouldn't know by any a program that can do a memory dump, that keeps the absolute offsets intact in one huge 2GB file, so that you could still search for Pointers?
## Post #205
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2010-03-19T14:14:38+00:00
- Post Title: Re: Guild Wars .DAT File

No, I do not know of a program that does that.

The only filenames I ever saw where for the maps, and they used an internal naming format that was somewhat convoluted.  As a matter of fact, there is an old interview on the net where one of the developers talks about  how they named the maps.  I think it had something to do with the music.  

If you use the GWDAT extraction tool, you'll see "hash numbers".  Those are actually "file numbers" and is how the game access the files internally.  Originally I thought that there would be a "master file" for each area that would have pointers to the other files but I never actually found one.  What seems to be the case is that those file numbers are hard-coded into the executable itself.  In fact, when you hit a new area you can see the game loading the ffna files by putting a dubug point on the ecx register. The executable useses ecx, then goes through huge amounts of error-checking before loading the file.  Simply adding breakpoints to reads of "SetFilePointerex"in kernel32 let's you follow what is going on.

Two issues I always ran into is that:

#1 My favorite debugger, OllyDBG doesn't handle multi-threaded programs well; it would deadlock on the current thread a lot when the game would access a thread other than the current one
#2 The game uses a lot of high-level language containers (like linked-lists) that added a huge amount of bloat to the assembly code which made it time-consuming to get to the actual code that we would be interested in.

You can get around both of these.  #1 can be worked around by breakpointing out of the thread completely (as the example above in kernel32)

and #2 just takes patience lol.

But with the fact that those model files have the vertexes in them and they can be processed is progress.  As I mentioned a while ago it's been years since I've done and gfx programming.

I run Linux now, and ollydbg crashes in Wine, but I might just dual-boot for a while and do some more work on this.

BD
## Post #206
- Username: mqstout
- Rank: ultra-n00b
- Number of posts: 6
- Joined date: Wed May 09, 2007 10:39 am
- Post datetime: 2010-05-11T14:56:39+00:00
- Post Title: Re: Guild Wars .DAT File

[http://wiki.guildwars.com/index.php?tit ... id=2016377](http://wiki.guildwars.com/index.php?title=Talk:Miniature&diff=prev&oldid=2016377)

Not sure if this is insightful or useful to anyone, but an A.net rep mentions AMDL files. Googling "amdl" doesn't seem to get me anything relevant. But, I figured I'd share.
## Post #207
- Username: BlackDragon
- Rank: advanced
- Number of posts: 60
- Joined date: Sat Feb 03, 2007 4:58 am
- Post datetime: 2010-05-12T13:28:46+00:00
- Post Title: Re: Guild Wars .DAT File

Those are MDL files.  The "A" stands for "ArenaNet".  They do that with all of their filetypes because some of them are customized.

They use "Granny" as a development tool but change the format some as far as I know.

BD
## Post #208
- Username: chrisvj
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Tue Jul 19, 2011 3:58 am
- Post datetime: 2011-07-18T20:02:20+00:00
- Post Title: Re: Guild Wars .DAT File

I am not sure if it is any help, but Hex Editor Neo can be used to view the file in assembly language, however it can not load the whole thing at once. You just use the unassembler
