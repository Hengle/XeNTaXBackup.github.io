## Post #1
- Username: zaramot
- Rank: double-veteran
- Number of posts: 783
- Joined date: Wed Jan 05, 2011 7:41 pm
- Post datetime: 2014-06-06T08:15:26+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

Hi guys! Here's maxscript to import Darksiders II: Death Lives (2012) PC models with bones+weights (3ds max 2009-2012)

P.S. Report bugs

Here's the tool to extract content (DS2Extract)
[viewtopic.php?f=16&t=9483&p=79039&hilit ... act#p79039](http://forum.xentax.com/viewtopic.php?f=16&t=9483&p=79039&hilit=DS2Extract#p79039)

[](http://piccy.info/view3/6507991/f034121f64b8da999b7f09d56a084da4/1200/)[](http://i.piccy.info/a3c/2014-06-06-08-03/i9-6507991/744x574-r)
[DarkSiders_II_PC.7z](https://xentaxbackup.github.io/file/7442_DarkSiders_II_PC.7z)
## Post #2
- Username: HeliosAI
- Rank: mega-veteran
- Number of posts: 166
- Joined date: Wed Nov 17, 2010 9:57 pm
- Post datetime: 2014-06-06T09:10:37+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

Thank you very much =)
## Post #3
- Username: amzerof6
- Rank: advanced
- Number of posts: 57
- Joined date: Sat Oct 23, 2010 10:50 pm
- Post datetime: 2014-06-12T11:57:08+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

that's very awsome !!
## Post #4
- Username: PredatorCZ
- Rank: mega-veteran
- Number of posts: 291
- Joined date: Tue Apr 22, 2014 3:32 am
- Post datetime: 2014-06-21T10:59:32+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

I love it!!!
## Post #5
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2015-10-19T16:37:14+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

I try to sum up this topic in the hope to have a little 'help. I tried the scrip and there are some problems. first of all the bone skeletons of character are not connected to each other, but this is not a problem, you can do very well in the hand without problems. but the most serious problem concerns the golem. when they charge are no skeleton and are all pieces to the center, while the "Champions" are integers, but no skeleton. same problem as reflected in the Blacksmith crazy in Ward Metals.
## Post #6
- Username: phay008
- Rank: beginner
- Number of posts: 30
- Joined date: Mon Jan 11, 2016 11:59 am
- Post datetime: 2016-01-11T04:15:27+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

thank you so much!
## Post #7
- Username: Sureno12
- Rank: ultra-n00b
- Number of posts: 3
- Joined date: Sun Aug 30, 2015 4:07 am
- Post datetime: 2016-03-03T07:17:53+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

Hi, how to use DS2Extract?

I tried putting it in ds2 media and click the exe, it doesnt run.

There's a readme.txt that come with the DS2Extract but i dont know what it means.

"Usage example:
DS2Extract.exe "C:\Steam\steamapps\common\Darksiders 2\media"  "/o:C:\DS2Out"

Thanks.

Sorry for bringing this thread back.
## Post #8
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-03-03T23:21:32+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

> Reply from Sureno12
>
> Hi, how to use DS2Extract?

I tried putting it in ds2 media and click the exe, it doesnt run.

There's a readme.txt that come with the DS2Extract but i dont know what it means.

"Usage example:
DS2Extract.exe "C:\Steam\steamapps\common\Darksiders 2\media"  "/o:C:\DS2Out"

Thanks.

Sorry for bringing this thread back.

you have to create a folder in c: calling it "DS2Out"

and not worry about it! Indeed, I hope you come back to life this thread! runs to take the golem but do not work well using these scripts
## Post #9
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-10T17:57:25+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

excuse me I have a problemacon constructs that do not have the skeleton. I discovered that the .o3d files are the files that contain the skeleton code. I now wonder is possible to load the model file along with the skeleton files?
## Post #10
- Username: raykingnihong
- Rank: mega-veteran
- Number of posts: 179
- Joined date: Mon Apr 07, 2014 3:06 am
- Post datetime: 2016-07-12T04:32:21+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

Hi guys! This game has been updated to the latest version. Darksiders II Deathinitive Edition. Here is the latest tool for ekey. [viewtopic.php?f=10&t=13515&hilit=upak](http://forum.xentax.com/viewtopic.php?f=10&t=13515&hilit=upak) It works perfectly. I try to import the model file with maxscript. But there is an error message. Hope to upgrade MAXscript. Thanks again. Here is the model sample.
[https://mega.nz/#!6YxSiYJA!_tJrjiatFv0M ... riy57Yy1IY](https://mega.nz/#!6YxSiYJA!_tJrjiatFv0M-M09M0VjupdN9Mu4U4iScriy57Yy1IY)
## Post #11
- Username: zaramot
- Rank: double-veteran
- Number of posts: 783
- Joined date: Wed Jan 05, 2011 7:41 pm
- Post datetime: 2016-07-12T10:09:32+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

I'll take a look at models from definite edition. Thanks a lot for the info
## Post #12
- Username: raykingnihong
- Rank: mega-veteran
- Number of posts: 179
- Joined date: Mon Apr 07, 2014 3:06 am
- Post datetime: 2016-07-13T10:25:50+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

Hi zaramot, my friend, I am looking forward to your great work.
## Post #13
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-13T12:03:09+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

if I speak, there is always the problem of the constructs without skeletons.
## Post #14
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-20T12:34:15+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

I'm working on the script of Zaramoth. I'm trying to import the missing bones of the constructs reading .o3d file. I try to start it but it appears this:

I leave the script so you can tell what is wrong:

```
if (heapSize < 200000) then
        heapSize = 2000000 -- allow ~ 40 MB instead of just 7.5 MB. Prevents "Runtime Error: Out of scripter memory"
gname = getOpenFileName \
caption:"Open .dcm from Mesh folder" \
types:"Darksiders II Model (*.dcm)|*.dcm" \
historyCategory:"DarkSiders2ObjectPresets"
g = fopen gname "rb"
fname = getOpenFileName \
caption:"Open .o3d from Mesh folder" \
types:"Darksiders II Skeleton  (*.o3d)|*.o3d" \
historyCategory:"DarkSiders2ObjectPresets"
f = fopen fname "rb"

clearlistener()
fn readHalfFloat fstream = (
    hf=readshort fstream #unsigned
    sign = bit.get hf 16
    exponent = (bit.shift (bit.and hf (bit.hexasint "7C00")) -10) as integer - 16
    fraction = bit.and hf (bit.hexasint "03FF")
    if sign==true then sign = 1 else sign = 0
    exponentF = exponent + 127
    outputAsFloat = bit.or (bit.or (bit.shift fraction 13) \
    (bit.shift exponentF 23)) (bit.shift sign 31)
    return bit.intasfloat outputasfloat*2
    )
fn readFixedString bstream fixedLen = (
local str = ""
for i = 1 to fixedLen do (
str += bit.intAsChar (ReadByte bstream #unsigned))
str
)
struct o3d_data
(
	boneids,weights
)

struct weight_data
(
	boneids,weights
)

struct mat_info_struct
(
MName, VertCount, FaceCount
)

struct Bone_Info_Struct
(
	Bone1,Bone2,Bone3,Bone4
)

struct Weight_Info_Struct
(
	Weight1,Weight2,Weight3,Weight4
)
clearlistener()

TotallFaceCount = #()
TotallVertCount = #()
ModelType = #()
BoneCount = #()

fseek f 0x0 #seek_set
DataOff = readlong f
MainMeshCount = readlong f
IndBuffCountCount = readlong f	
for x = 1 to IndBuffCountCount do (
AllFaceCount = readlong f
append TotallFaceCount AllFaceCount	
)
VBuffCountCount = readlong f
for x = 1 to VBuffCountCount do (
AllVertCount=readlong f
if AllVertCount<0 then
(
AllVertCount=(AllVertCount*-1)	
)	
append TotallVertCount AllVertCount	
)	
VBuffCountCount2 = (readlong f*-1)
for x = 1 to IndBuffCountCount do (
CountVert=readlong f	
)
for x = 1 to VBuffCountCount do (
CountInd=readlong f	
)	

Print ("Sec End @ 0x"+((bit.intAsHex(ftell f))as string))	

for a = 1 to MainMeshCount do (	
BNArr = #()	
Mat_Info = #()		
	
MType = readbyte f
append ModelType MType
VertType = readbyte f
numVerts = Readlong f
Unk1 = Readlong f
FaceOff = Readlong f	
	
Print ("Count Start @ 0x"+((bit.intAsHex(ftell f))as string))
	
if ModelType[a]==0 then 
(
append BoneCount (Readlong f)	
numMat = Readlong f
fseek f 0x18 #seek_cur
)	

if ModelType[a]==1 then 
(		
numMat = Readlong f
append BoneCount (Readlong f)
	
fseek f 0x18 #seek_cur
	
Print ("Bone Start @ 0x"+((bit.intAsHex(ftell f))as string))
		
for i = 1 to BoneCount[a] do (

BoneByte = readbyte f	
BoneNameSize=readshort f	
BoneName=readFixedString f BoneNameSize
	
c11 = ReadFloat f; c12 = ReadFloat f; c13 = ReadFloat f; c14 = ReadFloat f	
c21 = ReadFloat f; c22 = ReadFloat f; c23 = ReadFloat f; c24 = ReadFloat f	
c31 = ReadFloat f; c32 = ReadFloat f; c33 = ReadFloat f; c34 = ReadFloat f
c41 = ReadFloat f; c42 = ReadFloat f; c43 = ReadFloat f; c44 = ReadFloat f

BoneIdShort =#()
	
append BoneIdShort (readshort f) 

ukk1 = readshort f	
		
tfm = matrix3 [c11,c12,c13] [c21,c22,c23] [c31,c32,c33] [c41,c42,c43]
tfm=(scaleMatrix [-1,-1,1])*tfm
	
newBone = bonesys.createbone	\
				  tfm.row4	\
				  (tfm.row4 + 0.01 * (normalize tfm.row1)) \
				  (normalize tfm.row3)
			newBone.name = BoneName
			newBone.width  = 0.01
			newBone.height = 0.01
			newBone.transform = inverse tfm
			newBone.setBoneEnable false 0
			newBone.wirecolor = white
			newbone.showlinks = true
			newBone.pos.controller      = TCB_position ()
			newBone.rotation.controller = TCB_rotation ()				  
append BNArr newBone				  
)
)

Print ("Bone End @ 0x"+((bit.intAsHex(ftell f))as string))

for a = 1 to numMat do (
MByte = readbyte f	
MNameSize=readshort f	
MName=readFixedString f MNameSize
Long1 = readlong f	
Long2 = readlong f	
VertCount = readlong f	
Null1 = readlong f
FaceCount = readlong f		
Null2 = readlong f	
append Mat_Info (mat_info_struct MName:MName VertCount:VertCount FaceCount:FaceCount )		
)

print Mat_Info

BoneEnd = ftell f

fseek f (DataOff+FaceOff) #seek_set
	
vertArray = #()
Facearray = #()	
UV_array = #()
Weight_array =#()
B1_array =#()
W1_array =#()
		
Print ("Face Start @ 0x"+((bit.intAsHex(ftell f))as string))
	
for x = 1 to TotallFaceCount[a]/3 do 
(
f1 = (Readshort f #unsigned + 1) 
f2 = (Readshort f #unsigned + 1) 
f3 = (Readshort f #unsigned + 1) 
append Facearray [f3,f2,f1]
)

Print ("Face End @ 0x"+((bit.intAsHex(ftell f))as string))

if ModelType[a]==0 then 
(	
	
Print ("Vertex Start @ 0x"+((bit.intAsHex(ftell f))as string))	
	
for x = 1 to TotallVertCount[a] do 
(
getPos = ftell f + 12

bone1 = 0	
weight1 = 1.00	
	
vx = readFloat f
vy = readFloat f
vz = readFloat f

w = (weight_data boneids:#() weights:#())
maxweight = 0
if(weight1 != 0) then
   maxweight = maxweight + weight1

if(maxweight != 0) then (
      if(weight1 != 0) then (
         w1 = weight1 as float
         append w.boneids (bone1 + 1)
         append w.weights (w1)
      )  
   )
append Weight_array w				
fseek f getPos #seek_set
append vertArray [-vx,-vy,vz]
)	

Print ("Vertex End @ 0x"+((bit.intAsHex(ftell f))as string))
		
for x = 1 to TotallVertCount[a] do 
(
getPos = ftell f + 20
Null = readlong f
FFFF = readlong f
tu = readHalfFloat f
tv = readHalfFloat f*-1
p3 = readshort f
p4 = readshort f
p5 = readshort f
p6 = readshort f
fseek f getPos #seek_set	
append UV_array [tu,tv,0]	 	
)	

Print ("20 Bytes End @ 0x"+((bit.intAsHex(ftell f))as string))

for x = 1 to TotallVertCount[a] do 
(
getPos = ftell f + 16
fseek f getPos #seek_set		
)
msh = mesh vertices:vertArray faces:faceArray
msh.displayByLayer = false
msh.backfacecull = true
msh.wirecolor = (color 230 200 210)
msh.numTVerts = UV_array.count
buildTVFaces msh
-- msh.name=Mat_Info[a].MName
for j = 1 to UV_array.count do setTVert msh j UV_array[j]
for j = 1 to faceArray.count do setTVFace msh j faceArray[j]
	
)

if ModelType[a]==1 then 	
(	
	
Print ("12 Bytes Data Start @ 0x"+((bit.intAsHex(ftell f))as string))	
	
for x = 1 to TotallVertCount[a] do 
(
getPos = ftell f + 12
tu = readHalfFloat f
tv = readHalfFloat f*-1
p3 = readshort f
p4 = readshort f
p5 = readshort f
p6 = readshort f
fseek f getPos #seek_set	
append UV_array [tu,tv,0]	 
)	

Print ("Vertex Start @ 0x"+((bit.intAsHex(ftell f))as string))	
	
for x = 1 to TotallVertCount[a] do 
(
getPos = ftell f + 52

WeightCount = readlong f
	
vx = readFloat f
vy = readFloat f
vz = readFloat f
	
fseek f getPos #seek_set
append vertArray [-vx,-vy,vz]
)	

Print ("Vertex End @ 0x"+((bit.intAsHex(ftell f))as string))
	
Print ("Blend Weights @ 0x"+((bit.intAsHex(ftell f))as string))	
	
for x = 1 to TotallVertCount[a] do 
(
weight1 = Readfloat f
weight2 = Readfloat f
weight3 = Readfloat f
weight4 = Readfloat f
append W1_array (Weight_Info_Struct Weight1:Weight1 Weight2:Weight2 Weight3:Weight3 Weight4:Weight4)		
)	

Print ("Blend Indices @ 0x"+((bit.intAsHex(ftell f))as string))

for x = 1 to TotallVertCount[a] do 
(
bone1 = readbyte f #unsigned	
bone2 = readbyte f #unsigned	
bone3 = readbyte f #unsigned	
bone4 = readbyte f #unsigned	
append B1_array (Bone_Info_Struct Bone1:Bone1 Bone2:Bone2 Bone3:Bone3 Bone4:Bone4)		
)	

for a = 1 to W1_array.count Do (
w = (weight_data boneids:#() weights:#())
maxweight = 0
if(W1_array[a].Weight1 != 0) then
   maxweight = maxweight + W1_array[a].Weight1
if(W1_array[a].Weight2 != 0) then
   maxweight = maxweight + W1_array[a].Weight2
if(W1_array[a].Weight3 != 0) then
   maxweight = maxweight + W1_array[a].Weight3
if(W1_array[a].Weight4 != 0) then
   maxweight = maxweight + W1_array[a].Weight4

if(maxweight != 0) then
   (
      if(W1_array[a].Weight1 != 0) then
      (
         w1 = W1_array[a].Weight1 as float
         append w.boneids (B1_array[a].Bone1 + 1)
         append w.weights (w1)
      )
      if(W1_array[a].Weight2 != 0) then
      (
         w2 = W1_array[a].Weight2 as float
         append w.boneids (B1_array[a].Bone2 + 1)
         append w.weights (w2)
      )
      if(W1_array[a].Weight3 != 0) then
      (
         w3 = W1_array[a].Weight3 as float
         append w.boneids (B1_array[a].Bone3 + 1)
         append w.weights (w3)
      )
      if(W1_array[a].Weight4 != 0) then
      (
         w4 = W1_array[a].Weight4 as float
         append w.boneids (B1_array[a].Bone4 + 1)
         append w.weights (w4)
      )      
   )
append Weight_array w
)	


msh = mesh vertices:vertArray faces:faceArray
msh.numTVerts = UV_array.count
buildTVFaces msh
-- msh.name=Mat_Info[a].MName
for j = 1 to UV_array.count do setTVert msh j UV_array[j]
for j = 1 to faceArray.count do setTVFace msh j faceArray[j]
msh.displayByLayer = false
msh.backfacecull = true
msh.wirecolor = (color 230 200 210)

max modify mode
select msh
skinMod = skin ()
addModifier msh skinMod
for i = 1 to BoneCount[a] do
(
	maxbone = BNArr[i]
	if i != BoneCount[a] then 
		skinOps.addBone skinMod maxbone 0
	else
		skinOps.addBone skinMod maxbone 1
)
modPanel.setCurrentObject skinMod
for i = 1 to TotallVertCount[a] do (
   w = Weight_array[i]
   bi = #() --bone index array
   wv = #() --weight value array
   
   for j = 1 to w.boneids.count do
   (
      boneid = w.boneids[j]
      weight = w.weights[j]
      append bi boneid
      append wv weight
   )   
   
   skinOps.ReplaceVertexWeights skinMod i bi wv
)	
)
fseek f BoneEnd #seek_set
)

Print ("Mesh End @ 0x"+((bit.intAsHex(ftell f))as string))

fclose f 

```
## Post #15
- Username: PredatorCZ
- Rank: mega-veteran
- Number of posts: 291
- Joined date: Tue Apr 22, 2014 3:32 am
- Post datetime: 2016-07-20T14:16:26+00:00
- Post Title: PC Darksiders II: Death Lives maxscript

Well, to be honnest, .o3d is true header, while .dcm is buffer file. Basically those two files are merged in first game.
Its not only skeleton as you can guess, but its complete information about object (so I assume .o3d means "Object 3D").
So I found when I was researching it, that it contains simple animations aswell. Every information in .dcm like types, counts, etc. should be too in .o3d.
## Post #16
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-20T14:55:20+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from PredatorCZ
>
> Well, to be honnest, .o3d is true header, while .dcm is buffer file. Basically those two files are merged in first game.
Its not only skeleton as you can guess, but its complete information about object (so I assume .o3d means "Object 3D").
So I found when I was researching it, that it contains simple animations aswell. Every information in .dcm like types, counts, etc. should be too in .o3d.

but doing read .o3d files would resolve the fact that the constructs that have no skeletons?
## Post #17
- Username: PredatorCZ
- Rank: mega-veteran
- Number of posts: 291
- Joined date: Tue Apr 22, 2014 3:32 am
- Post datetime: 2016-07-20T15:02:31+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

Sure, like I wrote .o3d contains lot of information about model. It may have even bone hierarchy that is missing in .dcm.
## Post #18
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-20T16:26:24+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

sorry, but I do not understand English very well and is why I ask things quite obvious. clicked away, you'd know how to help me?
## Post #19
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-22T23:29:08+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

I tried to understand what you're doing but - to be honest - I did not.

Are you familiar with maxscript?
I don't see a parenting of bones in the script.
Seems you fixed that problem manually.

It's hard to follow your descriptions concerning the problem with the golem for example
without the sample and more details.

That's the reason why noone can help you out, imho.
## Post #20
- Username: SgtDirtDiver
- Rank: ultra-n00b
- Number of posts: 8
- Joined date: Fri Jun 17, 2016 12:48 pm
- Post datetime: 2016-07-23T01:33:45+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

Hey, whenever I try to run it and select /v I get "Failed to open "steam/steamapps/common/Darksider2/media/pc.mnfst" for reading. Please ensure you specified the correct source path (typically Darksiders 2 dir\media)" but I know for sure it is in there. Does anyone know why this might be?
## Post #21
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-23T09:26:40+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from shakotay2
>
> I tried to understand what you're doing but - to be honest - I did not.

Are you familiar with maxscript?
I don't see a parenting of bones in the script.
Seems you fixed that problem manually.

It's hard to follow your descriptions concerning the problem with the golem for example
without the sample and more details.

That's the reason why noone can help you out, imho.

I'm sorry if I was not clear, but my English is a bit 'limited and therefore it is difficult to express myself as I vorrie. however, I do not have much knowledge with scripts, and in fact I was starting to understand a p 'better with scipt of zaramot them. if you need any more information, I will try to furnish as much as possible.

the script works as it should with most of the models:

but when loading the constructs, the following happens:

using a program that sees the files in your code, you may notice that the .dcm files (model files) have registered with the bones:

but I am looking at .o3d files I found the bones that were missing:

moreover, in the first thred darksider, claim that .o3d files are the skeleton template files:
[viewtopic.php?f=16&t=11483&hilit=darksiders&start=15](http://forum.xentax.com/viewtopic.php?f=16&t=11483&hilit=darksiders&start=15)
Now what is asked if it was possible to modify the script so that sought the good not in the files. dcm but in .o3d file, or if I do it again convine one from scratch for just models here. I hope I was clear!
## Post #22
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-23T13:42:36+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from dibe91
>
> but when loading the constructs, the following happens:"constructs"? What is this? A submesh?


> but I am looking at .o3d files I found the bones that were missing:
>
> [...]
>
> moreover, in the first thred darksider, claim that .o3d files are the skeleton template files:
Could you upload a DS2 dcm file (size <1 MB, if possible) which has the problem and the suiting o3d file, please?
## Post #23
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-23T14:40:53+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

the "constructs" are the name of the models that have this problem. This is the simplest model, and is therefore complete.there is also the script
[http://www.mediafire.com/download/fwt29 ... struct.rar](http://www.mediafire.com/download/fwt29086q01n729/model+construct.rar)
## Post #24
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-23T18:59:29+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

ok, now I fully understand (I think) what you're trying to do.
Your basic idea seems to be correct - I'll see what I can do. 

Meanwhile you might try to "blast" the 50 objects to their correct positions.
Should be a matter of parent relativeness.

The o3d contains the bone names but not sure about the matrices.
There's suspicious 8 bytes before the names (after 0F 01) which might form a quaternion,
but of what? Half floats? Nope. Words? Nope?

I'm tending to use values from the dcm but they are not really symmetrical for bone 2/3 and 5/6 as they should be.
(Maybe they can used to put the submeshes into correct positions?)
Chances are great that they are bounding box values only.

first bone is Bone_CG_Ankle_R?

2. Bone_CG_Back_L
3. Bone_CG_Back_R

4. Bone_CG_BigToe_L

5. Bone_CG_Chest_L
6. Bone_CG_Chest_R


-8.16261 -3.50458 -6.70328 8.20317 5.67234 6.74692
---------- 1 0 2

-9.796 -9.2545 -13.0532 9.3252 12.3124 12.7371
---------- 2 0 2
-9.15796 -7.48943 -10.7405 10.2364 9.55678 11.6172
---------- 3 0 2

-2.24929 -1.3866 -2.18837 3.69089 1.38727 2.18264
---------- 4 0 2

-9.13452 -7.18897 -9.83185 7.92649 7.70572 11.9727
---------- 5 0 2
-8.34529 -6.9054 -10.9909 8.28095 6.63373 10.7525
---------- 6 0 2

Guess I'm missing to many rules/knowledge of structures. I'll have to check the dcm step by step. How boring...
I'm really wondering how anyone ever could have the patience to analyze this tedious stuff again and again.  

Kudos to zaramot!
## Post #25
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-24T06:47:56+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

thank you for your help. if you can solve the problem yourself you know very capable. if I can ask you something, I start to see how to do this kind of script would be interested in some games!
## Post #26
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-24T08:07:24+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from dibe91
>
> if I can ask you something, I start to see how to do this kind of script would be interested in some games!could you rephrase that sentence, please?
You mean how to create such a script?

Well, start analysing, get the 3D data file's structure(s). Getting faceindices and vertices is the simplest part in most cases.
You need an address map like such:
---------- 1 0 2
seek set 0x14fa + 0x8, Face Start @ 0x1502
Vertex/weights Start @ 0x1616 (68)
"Vertex End @ 0x1946"
"after uvs, 20 Bytes End @ 0x1e96"
---------- 2 0 2
seek set 0x14fa + 0xde4, Face Start @ 0x22de
Vertex/weights Start @ 0x2836 (348)
"Vertex End @ 0x3886"
"after uvs, 20 Bytes End @ 0x53b6"
---------- 3 0 2
seek set 0x14fa + 0x5484, Face Start @ 0x697e
Vertex/weights Start @ 0x6e52 (343)
"Vertex End @ 0x7e66"
"after uvs, 20 Bytes End @ 0x9932"
[...]

If the vertices, weights and matrices use floats then it's no so hard, getting harder with half floats and you're lost with shorts (words), more or less.

Anyway, here's an exploded mesh, using random positions in despair 



construct_meleea_exploded.jpg (214.89 KiB) Viewed 132 times

(Bone_CG_PinkyToe_L block should start at 0xEA5, sry)

btw, you could help finding the bones' parent ids and their positions:
in the lower part of the picture there's the bone ids marked (rectangle), a bone block could have additional 7 more bytes (00 08 000000 04 00).
After "0F 01" 8 bytes to follow, might be a quaternion.

I've logged the bonenames and marked the above mentioned by '8' (seven more bytes) and it doesn't make sense to me (not a 'flag' for child bones, obviously):
(Bone_CG_Ankle_R not in list)

1. Bone_CG_Back_L (9)
2. Bone_CG_Back_R (8)
3. Bone_CG_BigToe_L (8)
4. Bone_CG_Chest_L (9)
5. Bone_CG_Chest_R (9)
6. Bone_CG_ChestPlate (8)
7. Bone_CG_Collar (8)
8. Bone_CG_ElbowPad_R (8)
9. Bone_CG_Finger_Index1_L (8)
10. Bone_CG_Finger_Index1_R (8)
11. Bone_CG_Finger_Index2_L (8)
12. Bone_CG_Finger_Index2_R (8)
13. Bone_CG_Finger_Middle1_L (8)
14. Bone_CG_Finger_Middle1_R (8)
15. Bone_CG_Finger_Middle2_L (8)
16. Bone_CG_Finger_Middle2_R (8)
17. Bone_CG_Finger_Pinky1_L (8)
18. Bone_CG_Finger_Pinky1_R (8)
19. Bone_CG_Finger_Pinky2_L (8)
20. Bone_CG_Finger_Pinky2_R (8)
21. Bone_CG_Finger_Thumb1_L (8)
22. Bone_CG_Finger_Thumb1_R (8)
23. Bone_CG_Finger_Thumb2_L (8)
24. Bone_CG_Finger_Thumb2_R (8)
25. Bone_CG_Foot_L (9)
26. Bone_CG_Foot_R (9)
27. Bone_CG_ForeArm_L (9)
28. Bone_CG_ForeArm_R (9)
29. Bone_CG_Hand_L (8)
30. Bone_CG_Hand_R (8)
31. Bone_CG_HandPlate_L (8)
32. Bone_CG_HandPlate_R (8)
33. Bone_CG_Head (8)
34. Bone_CG_Heel_L (9)
35. Bone_CG_JunkPlate (8)
36. Bone_CG_KneeCap_R (8)
37. Bone_CG_KneePad_L (8)
38. Bone_CG_MidToe_L (8)
39. Bone_CG_Pelvis_L (8)
40. Bone_CG_Pelvis_R (9)
41. Bone_CG_PinkyToe_L (8)
42. Bone_CG_ShoulderPad_L (9)
43. Bone_CG_ShoulderPad_R (9)
44. Bone_CG_Spine1 (9)
45. Bone_CG_Thigh_L (9)
46. Bone_CG_Thigh_R (9)
47. Bone_CG_ThighPad_R (8)
48. Bone_CG_UpperArm_L (9)
49. Bone_CG_UpperArm_R (9)

What the heck - why don't we have Toe_R here?
---------
These values from o3d looked like quaternions (they are for rotations only, iirc)
but a^2 -b^2 -c^2 -d^2=-1 doesn't apply:

-0.435469 0.605304 0.232124 0.317423 
1. Bone_CG_Back_L
-0.431318 0.602161 0.444411 0.456832 
2. Bone_CG_Back_R


0.650075 -0.161931 0.852443 0.975555 
4. Bone_CG_Chest_L
0.654225 -0.162633 0.564714 0.859584 
5. Bone_CG_Chest_R
## Post #27
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-24T11:39:41+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from shakotay2
>
> 
could you rephrase that sentence, please?
You mean how to create such a script?

yes, I mean how can I make a script for 3d studio max to import models. I want to know how to start and what thou wast need.

> Reply from shakotay2
>
> 
What the heck - why don't we have Toe_R here?

the fact that it lacks that bone, I think it's because the developers wanted him as well. in the game in fact, many of these types of models are moving as if they were "gelatinous", especially when they are thrown to the ground. Watch this video to see what I mean: https: //[www.youtube.com/watch](http://www.youtube.com/watch)? v = l5pEjR6yyx0
## Post #28
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-24T13:41:13+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from dibe91
>
> yes, I mean how can I make a script for 3d studio max to import models. I want to know how to start and what thou wast need.yeah, if you start nearly from scratch that's kinda like the question: "can you teach me how to build a rocket"?  

It's a very long path to go and I fear I don't have the time to lead you all the stony way.

I've started to show some tiny approaches, here for example:
[viewtopic.php?f=16&t=11090&p=118039&hil ... pt#p118039](http://forum.xentax.com/viewtopic.php?f=16&t=11090&p=118039&hilit=maxscrript#p118039)

but you're best of to search the forum for threads from Alsair or Seyren for example.
Dive into their projects, view the dozens of maxscripts in this forum.

After two or three months of hard learning you'll know more.

btw: for the constructs I'd say we'd try to fix the submesh positions as a first step
The bones' parent IDs, well that a senseless riddle not worth dealing with.

As you said we can create them manually.
## Post #29
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-24T14:11:37+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

I know very well that it is very difficult to work on the script, but enough for me just to have an idea for now. Thanks for your help! just one more thing, you think you can solve the problem of those models without bones and weights,  or not?
## Post #30
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-24T15:29:33+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

I don't see a chance, to be honest.
The construct_meleea.dcm, I've looked at seems to contain ModelType 0.
For this ModelType there's no bone IDs, no weights in the dcm (nor in the o3d) , they are all set to 1 1.0 (one constant boneid per vertex).
I'm asking myself "how is the skinning realized here"?

So the skinOps.ReplaceVertexWeights is only run for ModelType 1.

Is there any moving construct to be seen in the video you pointed to?

(If you happen to find the boneids/weights I could think of building a skeleton manually, 50 bones are not too many.  )
## Post #31
- Username: zaramot
- Rank: double-veteran
- Number of posts: 783
- Joined date: Wed Jan 05, 2011 7:41 pm
- Post datetime: 2016-07-24T15:49:11+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

Hmm, I guess, this could correct, that all bone weights are set to 1.0 it's a some sort of a golem. So, I'm sure each part of mesh weighted to some bone with 1.0 (all weights are red) it's doesnt require to have miltiple weights at all, I think. Though, if there's no bone-id's this is weird. And if all mesh parts are on the 0,0,0 coordinates (lying on the "floor" in 3ds max) I guess, those parts should be referensed to specific bones (their possition), I've seen something like that in many games, for example Armored Core series
## Post #32
- Username: PredatorCZ
- Rank: mega-veteran
- Number of posts: 291
- Joined date: Tue Apr 22, 2014 3:32 am
- Post datetime: 2016-07-24T17:17:20+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

According to situation, additional bones in .o3d are reference transformation of model object.
Same "thing" also have static objects used in maps.
## Post #33
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-24T17:59:00+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from zaramot
>
> Hmm, I guess, this could correct, that all bone weights are set to 1.0 it's a some sort of a golem. So, I'm sure each part of mesh weighted to some bone with 1.0 (all weights are red) it's doesnt require to have miltiple weights at all, I think. Though, if there's no bone-id's this is weird. And if all mesh parts are on the 0,0,0 coordinates (lying on the "floor" in 3ds max) I guess, those parts should be referensed to specific bones (their possition), I've seen something like that in many games, for example Armored Core series

to tell the truth is not so. there is a model in which the mesh are in the right position to form the model in the position t mode!


anyway, I thought maybe we can see in the animation files then see if you can find skinning! if you want, I can be passed all the models that have the same problem, although there is a model that has the normal bone weights, but the right arm is like constructs, fragmented.
## Post #34
- Username: PredatorCZ
- Rank: mega-veteran
- Number of posts: 291
- Joined date: Tue Apr 22, 2014 3:32 am
- Post datetime: 2016-07-24T18:09:54+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from dibe91
>
> 
to tell the truth is not so. there is a model in which the mesh are in the right position to form the model in the position t mode!

This model is integrated, If you ever saw construct in game you can notice when they're spawning they are multiple objects that are assembled into final pose. Also if you destroy them, those exact parts will break and fall away like normal physics object. Thats why they are "laying on ground".
## Post #35
- Username: zaramot
- Rank: double-veteran
- Number of posts: 783
- Joined date: Wed Jan 05, 2011 7:41 pm
- Post datetime: 2016-07-24T18:49:26+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

And this T-posed model doesn't have bones, right? Can you send me this one? Maybe it doesn't have skeleton, but weights are there.
## Post #36
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-24T21:36:42+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

of course! I leave you a folder with all the models that have the same problem: [http://www.mediafire.com/download/v1538 ... models.rar](http://www.mediafire.com/download/v1538ie7cb5d3x3/models.rar)
## Post #37
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-25T12:49:06+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from shakotay2
>
> 
(If you happen to find the boneids/weights I could think of building a skeleton manually, 50 bones are not too many.  )

I also had thought about this solution, but since I also wanted to use the original animations!
## Post #38
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-25T19:12:31+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

well, I had a look at construct_meleeb_gibsdeathpile.o3d, for the first bone CG_Melee_ShoulderPad_R_GIB they claim to be Position and Rotation included but I'm not shure about the 4 words before those strings.

So i just logged the floats - maybe you find it worth to build a skeleton from?
But I'm not sure - as always  - because it's a dead pile? Does it even move?

1. CG_Melee_ShoulderPad_R_GIB
18.5056 1.19881 79.5893  87.4511 36.4022 -59.6333OK

2. Col_CG_Melee_ShoulderPad_R
-4.65084 0.805786 4.61512 -10.7199 -33.1909 3.62144

3. CG_Melee_ShoulderPad_L_GIB
-13.5157 0.799671 76.7312 40.3613 -14.8678 -6.09042

4. Col_CG_Melee_ShoulderPad_L
2.90184 0.857014 3.86457 -18.2893 31.5556 -20.1058

5. CG_Melee_Chest_R_GIB
6.20582 10.077 74.8764 28.9512 -3.17058 -11.7779

6. Col_CG_Melee_Chest_R
-0.299049 0.0619125 3.01348 

7. CG_Melee_Back_L_GIB
-1.18319 -2.89943 71.9382 33.9333 1.1004 -8.67054

8. Col_CG_Melee_Back_L
-9.53674e-007 0.395168 4.21686 8.53775e-007 1.60083e-007 9.33814e-007

9. CG_Melee_Back_R_GIB
9.44193 -0.575027 77.0312 47.0661 -19.4313 -27.617

10. Col_CG_Melee_Back_R
-0.608807 0.592415 4.48188 1.70755e-005 3.84198e-006 -2.13444e-006

11. CG_Melee_Chest_L_GIB
-6.42328 5.71465 75.2441 36.1561 -23.4883 -10.4133

12. Col_CG_Melee_Chest_L
1.14441e-005 0.243343 3.388 5.97642e-006 2.56132e-006 3.4151e-006

13. CG_Melee_ForeArm_R_GIB
32.9846 3.05361 76.3196 44.5644 -46.554 35.0223

14. Col_CG_Melee_ForeArm_R
0.227783 -0.971281 1.2892 30.2567 -9.58765 5.22233

15. CG_Melee_Foot_L_GIB
-11.1498 6.99076 46.3042 26.8876 -20.3844 90.483

16. Col_CG_Melee_Foot_L
0.116283 0.343813 1.97467 

17. CG_Melee_Foot_R_GIB
16.2906 11.7742 44.9202 27.2885 -25.8978 42.4238

18. Col_CG_Melee_Foot_R
-0.111542 0.243084 1.86281 -8.53773e-007 1.70755e-006 8.11085e-006

19. CG_Melee_ForeArm_L_GIB
-30.7238 1.22347 69.4801 72.7241 31.0357 -30.5267

20. Col_CG_Melee_ForeArm_L
-0.218575 -0.633118 1.08222 30.7858 5.92668 2.77158

21. CG_Melee_Spine1_GIB
2.68672 1.56323 65.9451 28.5818 -3.67543 9.80169

22. Col_CG_Melee_Spine1
-1.90735e-006 7.62939e-006 3.30225 -2.73208e-005 3.20165e-007 9.60496e-007

23. VFX_HeartStone
0.0 0.0 44.0216 0.0 0.0 0.0
## Post #39
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-25T19:24:29+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

that kind of model should be when the model is a mecchio of inanimate pieces which then make up together. are not also gladly that you can get something from them!
## Post #40
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-26T06:10:57+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

I've tried it with the hulk and it's not very promissing.
(I feel a waste of time and life...  )



hulk_skel.jpg (170.61 KiB) Viewed 102 times
## Post #41
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-26T06:36:46+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

> Reply from shakotay2
>
> I've tried it with the hulk and it's not very promissing.
(I feel a waste of time and life...  )
hulk_skel.jpg

It is already progress I would say, compared to the fact that there was nothing. try to see the "construct_championa"
## Post #42
- Username: shakotay2
- Rank: MEGAVETERAN
- Number of posts: 4300
- Joined date: Fri Apr 20, 2012 4:24 pm
- Post datetime: 2016-07-26T08:58:25+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

yeah, about 153 bones - would have to cut off up to 100 of them (a shitload of work) - also that reduced skeleton would not work with anims
## Post #43
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-26T13:13:21+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

there are still strange things with these models.
## Post #44
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-28T18:08:09+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

I think ver found the solution to my problem I found file called "construct_base.o3d" and I think I found the solution to the problem. in the file I found the word "Skeleton":

I leave the file:
[http://www.mediafire.com/download/ldrkr ... t_base.rar](http://www.mediafire.com/download/ldrkr24gkjxcz4v/construct_base.rar)
## Post #45
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2016-07-29T06:44:05+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

ok, according zaramot, it is possible to solve the problem, but I first have to upload the files .o3d (the skeleton) and then the .dcm file (meshes). Now I'm trying to create one script that can only rot the .o3d file.
## Post #46
- Username: chunkyb
- Rank: ultra-n00b
- Number of posts: 1
- Joined date: Wed Jul 06, 2011 9:32 am
- Post datetime: 2017-08-14T21:55:45+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

hey guys and gals, I was just wondering if anyone had any luck loading the o3d+dcm files at this point?  I don't think I'm smart enough to figure out how to modify it
I'd be pretty content with just being able to import a model without the bones or animation or anything as I'm really just using it for educational purposes
## Post #47
- Username: PredatorCZ
- Rank: mega-veteran
- Number of posts: 291
- Joined date: Tue Apr 22, 2014 3:32 am
- Post datetime: 2017-08-19T09:27:29+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

O3D files, aka Binary Objects referred in game's code, are compiled scripts with similar hiearchy to XML, they store all informations like bones, links, meshes definitions, lods, and many (or any) other properties. They are also used for particle effects and materials. Most of types used in those objects are readable, but they also use one particular datatype that can be instanced or linked whinch makes reading file afterwards really hard.

As for DCM, those files store only buffers, and bones in absolute transformations.

As far for animations, they should be same or slightly modified files from first Darksiders game, whinch should be easy to read.
## Post #48
- Username: dibe91
- Rank: mega-veteran
- Number of posts: 223
- Joined date: Tue Jul 29, 2014 4:06 pm
- Post datetime: 2017-08-19T15:01:01+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

I would like to reap this thead in the hope that someone can help me. Scipt works but does not work with some overhead models of the constructs because the skeleton is in the O3D files. Is there a way to solve the problem?
## Post #49
- Username: Doctor Loboto
- Rank: mega-veteran
- Number of posts: 213
- Joined date: Mon Oct 06, 2008 9:52 am
- Post datetime: 2018-12-04T02:53:03+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

Hey uh, is there a version of the script that has the separate material groups? Some models have multiple textures but the current script only has one material group for the entire model.
## Post #50
- Username: tempaccount555
- Rank: beginner
- Number of posts: 27
- Joined date: Sun May 12, 2019 8:14 pm
- Post datetime: 2020-01-06T13:54:15+00:00
- Post Title: Re: PC Darksiders II: Death Lives maxscript

Can anyone share the Samael model as FBX with bones for me? I unfortunately don't get it to work using the max script...
