## Post #1
- Username: cra0
- Rank: ultra-veteran
- Number of posts: 438
- Joined date: Fri Apr 27, 2012 4:37 pm
- Post datetime: 2014-01-08T13:13:23+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Counter-Strike Online2
I'm not sure if anyone has looked at this at all.


Game: Counter-Strike Online2
Publisher: Nexon


EXE seems packed however you can dump it.



PKG files seem encrypted has a MD5 filename hash at the top i think



Only PKG reference I've found has one of the filenames hardcoded



Which has some decrypt function linked to it.
Not sure if it's related
[http://www.openssl.org/docs/crypto/EVP_EncryptInit.html](http://www.openssl.org/docs/crypto/EVP_EncryptInit.html)


EXE(PACKED)/(UNPACKED) plus pkg archives
[https://www.dropbox.com/sh/dfs4mae81hi26mi/FLswZF_hvZ](https://www.dropbox.com/sh/dfs4mae81hi26mi/FLswZF_hvZ)


Hope someone can help
## Post #2
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-25T11:21:42+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Well 1b87c6b551e518d11114ee21b7645a47.pkg - Encrypted main file contained list of avaible PKGs.

Structure only for this file:

```
{
	WORD	dwVersion;  // 0x01 0x00
	BYTE	bEncryption;  // ID of encrypt algorithm ( 1 - AES-128-CBC , 0 - BlowFish-CBC )
	BYTE	bFlag;  // 6
	DWORD  dwDataSize;
};
```


Key generating automaticly

```

int __cdecl FileSystem_Init(int bFlag, int bEncryption, const char *pPKGName, int pScrBuffer, int dwSize, int pDstBuffer)
{
  int result;
  char pKey[16] = { 0 };

  if ( FileSystem_MakeKey((signed int)&bEncryption, (int)&pKey, pPKGName) == 1 )
  {
    result = FileSystem_Decrypt((int)&bFlag, pScrBuffer, dwSize, (int)&pKey, pDstBuffer);
  }
  else
  {
    printf("Error: Unable generate key!\n");
    result = 0;
  }
  return result;
}

```


Default algorithm is AES-128 in CBC mode.

```

	static unsigned char pKey[16] = {0x51, 0xFE, 0xAA, 0x02, 0x43, 0x0A, 0xFE, 0xC6, 0xC2, 0x9E, 0x24, 0x24, 0x2B, 0x99, 0xFF, 0x77};
	EVP_CIPHER_CTX ctx;
	EVP_CIPHER_CTX_init(&ctx);
	cipher = EVP_aes_128_cbc();

	EVP_DecryptInit(&ctx, cipher, pKey, 0);
	EVP_DecryptUpdate(&ctx, pBuffer, (int*)&PKGHeader.dwSize, pBuffer, PKGHeader.dwSize);
	EVP_DecryptFinal(&ctx, pBuffer, (int*)&PKGHeader.dwSize);
	EVP_CIPHER_CTX_cleanup(&ctx);
```


And we get decrypted variant > [here](http://pastebin.com/NEjBwz71)

Other PKGs also encrypted with AES, Key and IV generated by other functions > it's MD5 + custom passwords > kbuj37shgh&@4n!2; and [wospo-02i after generating key and iv they converted to string and using as key and iv.
## Post #3
- Username: cra0
- Rank: ultra-veteran
- Number of posts: 438
- Joined date: Fri Apr 27, 2012 4:37 pm
- Post datetime: 2014-06-25T12:08:05+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Great work ekey
## Post #4
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-25T13:16:49+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Okay, what's next!..... We need generate key and iv for decrypt PKG data's. How it work:

1 ) Get any PKG
2 ) Get name from full path
3 ) Set Password 1
4 ) Calculate MD5 hash for Password 1
5 ) Set Password 2
6 ) Calculate MD5 hash for Password 2
7 ) Convert Password 1 Hash to string
8 ) Convert Password 2 Hash to string
9 ) Set KEY and IV
10 ) Decrypt with AES
11 ) Profit 

Example:

```
char* p_PKG_Name = "006c2458c2c24beb0b08e45e1ea3874e.pkg"
char* p_PKG_Password_1 = "kbuj37shgh&@4n!2;";
char* p_PKG_Password_2 = "[wospo-02i";
char* p_PKG_Set_Password_1 = p_PKG_Password_1 + p_PKG_Name;
char* p_PKG_Set_Password_2 = p_PKG_Password_2 + p_PKG_Name;
char* p_PKG_Hash_Password_1[16]; // 6f24769ebe7c9acc6328ad7d3be1ebc3
char* p_PKG_Hash_Password_2[16]; // 4422261f9839d54f7fece6448b062522
string p_PKG_Key;
string p_PKG_Iv;

1 ) Open -> p_PKG_Path
2 ) Get Name -> p_PKG_Name
3 ) Set Password 1 -> p_PKG_Set_Password_1
4 ) Get MD5 hash from Password 1 =
    
    MD5Init(&ctx);
    MD5Update(&ctx, p_PKG_Set_Password_1, strlen(p_PKG_Set_Password_1));
    MD5Final(p_PKG_Hash_Password_1, &ctx);
   
5 ) Set Password 2 -> p_PKG_Set_Password_2
6 ) Get MD5 hash from Password 2 =

    MD5Init(&ctx);
    MD5Update(&ctx, p_PKG_Set_Password_2, strlen(p_PKG_Set_Password_2));
    MD5Final(p_PKG_Hash_Password_2, &ctx);

7 ) p_PKG_Key = 6f24769ebe7c9acc6328ad7d3be1ebc3
8 ) p_PKG_Iv = 4422261f9839d54f7fece6448b062522
9 ) Set Key / Iv and Decrypt data =

    p_PKG_Iv = 4422261f9839d54f7fece6448b062522 -> 7fece6448b062522 - also need reverse
    p_PKG_Key  = 6f24769ebe7c9acc6328ad7d3be1ebc3 -> 6f24769ebe7c9acc

    >>> pkg_aes_decrypt(int ctx, int pKey, int*pIV, int dwKeySize, int dwBlockSize) <<<

    pkg_aes_init(&context, pKey, pIv, 16, 16);

10 ) Lalalala ...... Done :)

```


Result
## Post #5
- Username: oamio
- Rank: veteran
- Number of posts: 98
- Joined date: Sun Mar 06, 2011 9:52 pm
- Post datetime: 2014-06-26T15:18:42+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Omg, very good Elky, cra0
## Post #6
- Username: aluigi
- Rank: VVIP member
- Number of posts: 1916
- Joined date: Thu Dec 08, 2005 7:26 pm
- Post datetime: 2014-06-26T20:18:27+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

@ekey can you take a look at the following script?
Unfortunately your examples don't match the steps you provide.

```
get bEncryption byte
get bFlag byte
get dwDataSize long

get p_PKG_Name filename
set p_PKG_Password_1 binary "hs2kbuj37shgh&@4n!2;"
set p_PKG_Password_2 binary "[wospo-02i"

string p_PKG_Set_Password_1 p= "%s%s" p_PKG_Password_1 p_PKG_Name
string p_PKG_Set_Password_2 p= "%s%s" p_PKG_Password_2 p_PKG_Name

encryption md5 p_PKG_Set_Password_1
print "%QUICKBMS_HEXHASH%"
string KEY l QUICKBMS_HEXHASH
string KEY >>= 16
print "key  %KEY% %p_PKG_Set_Password_1%"

encryption md5 p_PKG_Set_Password_2
print "%QUICKBMS_HEXHASH%"
string IVEC l QUICKBMS_HEXHASH
string IVEC << 16
#string IVEC r IVEC # reverse?
print "ivec %IVEC% %p_PKG_Set_Password_2%"

if bEncryption == 0
    encryption blowfish KEY IVEC
else
    encryption aes_128_cbc KEY IVEC
endif

savepos OFFSET
log "dump.dat" OFFSET dwDataSize
```
## Post #7
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-26T21:53:54+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Well this part not needed because it's only for 1b87c6b551e518d11114ee21b7645a47.pkg

```
get bEncryption byte
get bFlag byte
get dwDataSize long
```


In other PKGs with datas > Header is 32 bytes - just md5 hash null terminated string of full file.

PS: and yes my bad > password 1 -> kbuj37shgh&@4n!2;

```
- SCRIPT's MESSAGE:
  6F24769EBE7C9ACC6328AD7D3BE1EBC3

- SCRIPT's MESSAGE:
  key  6f24769ebe7c9acc kbuj37shgh&@4n!2;006c2458c2c24beb0b08e45e1ea3874e.pkg

- SCRIPT's MESSAGE:
  4422261F9839D54F7FECE6448B062522

- SCRIPT's MESSAGE:
  ivec 7fece6448b062522 [wospo-02i006c2458c2c24beb0b08e45e1ea3874e.pkg
```
## Post #8
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-26T22:14:37+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Ok here correct one

```
savepos OFFSET
get SIZE asize
math SIZE -= 0x21

get p_PKG_Name filename
set p_PKG_Password_1 binary "kbuj37shgh&@4n!2;"
set p_PKG_Password_2 binary "[wospo-02i"
string p_PKG_Set_Password_1 p= "%s%s" p_PKG_Password_1 p_PKG_Name
string p_PKG_Set_Password_2 p= "%s%s" p_PKG_Password_2 p_PKG_Name

encryption md5 p_PKG_Set_Password_1
print "%QUICKBMS_HEXHASH%"
string KEY l QUICKBMS_HEXHASH
string KEY >>= 16
print "key  %KEY% %p_PKG_Set_Password_1%"

encryption md5 p_PKG_Set_Password_2
print "%QUICKBMS_HEXHASH%"
string IVEC l QUICKBMS_HEXHASH
string IVEC << 16
print "ivec %IVEC% %p_PKG_Set_Password_2%"

encryption aes_128_cbc KEY IVEC
log "dump.dat" OFFSET SIZE
```


After use script



Simple PKG in attach
[006c2458c2c24beb0b08e45e1ea3874e.rar](https://xentaxbackup.github.io/file/7519_006c2458c2c24beb0b08e45e1ea3874e.rar)
## Post #9
- Username: aluigi
- Rank: VVIP member
- Number of posts: 1916
- Joined date: Thu Dec 08, 2005 7:26 pm
- Post datetime: 2014-06-27T09:43:42+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Thanks for the update Ekey.
But there are still a couple of things that don't work:

1)
how to decrypt 1b87c6b551e518d11114ee21b7645a47.pkg?
I tried the following but doesn't work:

```
log "dump.dat" 8 0x100
```


2)
the files in the archives (like those in 006c2458c2c24beb0b08e45e1ea3874e.pkg) are encrypted
## Post #10
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-27T10:11:47+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

> Reply from aluigi
>
> Thanks for the update Ekey.
But there are still a couple of things that don't work:

1)
how to decrypt 1b87c6b551e518d11114ee21b7645a47.pkg?
I tried the following but doesn't work:
Code: Select allencryption aes_128_ecb "\x51\xFE\xAA\x02\x43\x0A\xFE\xC6\xC2\x9E\x24\x24\x2B\x99\xFF\x77"
log "dump.dat" 8 0x100
Hm i will check it later.

> Reply from aluigi
>
> 2)
the files in the archives (like those in 006c2458c2c24beb0b08e45e1ea3874e.pkg) are encrypted
Yeah files inside also encrypted. I guess it's AES but not sure.

PS: Also it is necessary while decrypt need align the blocks by 16 bytes each. I use XySSL and for correct decrypt need set XYSSL_PADLOCK_C and YSSL_HAVE_X86, otherwise the first and the last block will be in the form of trash like this >
[18du8n.png](https://xentaxbackup.github.io/file/7520_18du8n.png)
## Post #11
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-27T16:38:39+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

> Reply from aluigi
>
> Thanks for the update Ekey.
But there are still a couple of things that don't work:

1)
how to decrypt 1b87c6b551e518d11114ee21b7645a47.pkg?
I tried the following but doesn't work:
Code: Select allencryption aes_128_ecb "\x51\xFE\xAA\x02\x43\x0A\xFE\xC6\xC2\x9E\x24\x24\x2B\x99\xFF\x77"
log "dump.dat" 8 0x100
Strange because generated key is \x51\xFE\xAA\x02\x43\x0A\xFE\xC6\xC2\x9E\x24\x24\x2B\x99\xFF\x77
Try BlowFish  

> Reply from aluigi
>
> 2)
the files in the archives (like those in 006c2458c2c24beb0b08e45e1ea3874e.pkg) are encrypted

Files data also encrypted with AES. As key using MD5 string from header 
[1.png](https://xentaxbackup.github.io/file/7524_1.png)
## Post #12
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-27T19:16:57+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

[1.png](https://xentaxbackup.github.io/file/7525_1.png)
## Post #13
- Username: cra0
- Rank: ultra-veteran
- Number of posts: 438
- Joined date: Fri Apr 27, 2012 4:37 pm
- Post datetime: 2014-06-27T21:16:59+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

11/10 Bravo
## Post #14
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-27T22:00:48+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Well final : how file data decrypting? it's easyyyyyyyyyy 

Example:

FileName: cstrike/materials/dev/identitylightwarp.vtf
Extract Filename from full path: > identitylightwarp.vtf
Split with Password_3 > 37uh@!jsn;b
You get filename like > 37uh@!jsn;bidentitylightwarp.vtf
Now calculate md5 hash
Set output hash as key and iv
Read file data
Set Key/IV
Decrypt data
Save data
Profit! huh!
## Post #15
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-27T22:45:42+00:00
- Post Title: Counter-Strike Online 2 (.PKG) Archive

Okay. Unpacker for tests > [here](http://forum.xentax.com/viewtopic.php?f=10&t=11640)

Enjoy!
## Post #16
- Username: aluigi
- Rank: VVIP member
- Number of posts: 1916
- Joined date: Thu Dec 08, 2005 7:26 pm
- Post datetime: 2014-06-29T13:16:02+00:00
- Post Title: Re: Counter-Strike Online 2 (.PKG) Archive

[quote="Ekey"]Strange because generated key is \x51\xFE\xAA\x02\x43\x0A\xFE\xC6\xC2\x9E\x24\x24\x2B\x99\xFF\x77
Try BlowFish[/code]???
probably you forgot to give us the IVEC.

I tried the other archives you placed on dropbox but only 006c2458c2c24beb0b08e45e1ea3874e.pkg gets decrypted correctly, so it means that there is something you didn't tell us.

Anyway I give up because I have already wasted lot of my time with these incomplete and wrong information.
Sorry, anyway there is your tool available so no need for a quickbms script (except for my personal curiosity).
## Post #17
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2014-06-29T16:18:46+00:00
- Post Title: Re: Counter-Strike Online 2 (.PKG) Archive

> Reply from aluigi
>
> I tried the other archives you placed on dropbox but only 006c2458c2c24beb0b08e45e1ea3874e.pkg gets decrypted correctly, so it means that there is something you didn't tell us.
PKGs on dropbox from latest game version, not me upload them. You can't decrypt them because in newest version passwords changed. I can send you if you needed. I share info for old client
## Post #18
- Username: Igor13
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Mon Sep 07, 2020 7:05 am
- Post datetime: 2020-09-07T00:00:32+00:00
- Post Title: Re: Counter-Strike Online 2 (.PKG) Archive

> Reply from Ekey ↑Mon Jun 30, 2014 12:18 am at Mon Jun 30, 2014 12:18 am
>
> 
aluigi wrote:I tried the other archives you placed on dropbox but only 006c2458c2c24beb0b08e45e1ea3874e.pkg gets decrypted correctly, so it means that there is something you didn't tell us.
PKGs on dropbox from latest game version, not me upload them. You can't decrypt them because in newest version passwords changed. I can send you if you needed. I share info for old client


@Ekey, could you explain how did you found keys?

Or post this: 
```
SCRIPT'S MESSAGE
```
 script?
## Post #19
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2020-09-07T14:30:41+00:00
- Post Title: Re: Counter-Strike Online 2 (.PKG) Archive

> Reply from Igor13 ↑Mon Sep 07, 2020 8:00 am at Mon Sep 07, 2020 8:00 am
>
> 
@Ekey, could you explain how did you found keys?
Reverse engineering
## Post #20
- Username: Igor13
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Mon Sep 07, 2020 7:05 am
- Post datetime: 2020-09-07T18:39:56+00:00
- Post Title: Re: Counter-Strike Online 2 (.PKG) Archive

> Reply from Ekey ↑Mon Sep 07, 2020 10:30 pm at Mon Sep 07, 2020 10:30 pm
>
> 
Reverse engineering

Ok, then seems like im wasting my time as alugi, but ok, let's try again.
So, the first key is there:
[https://i.imgur.com/******.png](https://i.imgur.com/******.png)

What's green stuff stays for?

The second one it there:
[https://i.imgur.com/******.png](https://i.imgur.com/******.png)

But files are still encrypted, is there any additional layer? Do you have any external contacts, like discord/steam or something, coz you have closed PM.
## Post #21
- Username: Ekey
- Rank: M-M-M-Monster veteran
- Number of posts: 1823
- Joined date: Wed Mar 31, 2010 1:54 pm
- Post datetime: 2020-09-07T19:12:55+00:00
- Post Title: Re: Counter-Strike Online 2 (.PKG) Archive

You can check this project if you are interested > [https://github.com/L-Leite/UnCSO2](https://github.com/L-Leite/UnCSO2)

In particular this > [https://github.com/L-Leite/UnCSO2/blob/ ... actory.cpp](https://github.com/L-Leite/UnCSO2/blob/master/sources/dynpkgfilefactory.cpp)
