## Post #1
- Username: pixellegolas
- Rank: ultra-veteran
- Number of posts: 423
- Joined date: Tue Aug 12, 2008 6:30 am
- Post datetime: 2011-04-14T18:24:41+00:00
- Post Title: Rusty hearts .pck

Game is now open beta and here are beginning and end of a .pck file:

[http://www.2shared.com/file/hV3u_VI_/rusty_hearts.html](http://www.2shared.com/file/hV3u_VI_/rusty_hearts.html)

Did a quick scan with signsrch but forgot a little about info, think it said gamekiller compression or such
## Post #2
- Username: S0UZ
- Rank: advanced
- Number of posts: 40
- Joined date: Tue Apr 05, 2011 6:46 pm
- Post datetime: 2011-04-15T06:30:54+00:00
- Post Title: Rusty hearts .pck

Wow cool design but it still not support English yet
## Post #3
- Username: iaw
- Rank: advanced
- Number of posts: 52
- Joined date: Wed Oct 21, 2009 7:52 pm
- Post datetime: 2011-04-15T09:05:22+00:00
- Post Title: Rusty hearts .pck

Sorry, English is not good.
File index in the f00X.dat,But f00X.dat is encrypted.
## Post #4
- Username: Fiel
- Rank: advanced
- Number of posts: 46
- Joined date: Mon Dec 17, 2007 1:29 am
- Post datetime: 2011-08-01T06:39:40+00:00
- Post Title: Rusty hearts .pck

Sup guys.

I was able to crack all of the files. It took me about 5 - 6 hours in total to crack. However, I don't feel it's a good idea to release how to crack them. After looking at the information, knowing how to change the information could be lethal for the game's health which is something I don't want to hurt.

All that I will say regarding the structure of the game is that the guy in post #3 is correct and that you cannot fully crack everything without using a debugger. It's impossible. You'd never be able to guess the encryption. The last tidbit of information that I will give you is that there are two layers of encryption to fully crack the files.

Good luck and happy hunting.
## Post #5
- Username: chrrox
- Rank: Moderator
- Number of posts: 2602
- Joined date: Sun May 18, 2008 10:01 pm
- Post datetime: 2011-08-01T10:59:08+00:00
- Post Title: Rusty hearts .pck

No online game has ever been broken by modifing the client files directly.
The thing that breaks games are realtime memory modding programs like cheat engine.
I really hope you change your mind on releasing the info.
## Post #6
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-08-01T11:08:09+00:00
- Post Title: Rusty hearts .pck

What's the use of coming in here and not sharing information? 

"Look, I cracked it, but I'm not going to share...tough luck on you all" is basically what you're saying. That is not the rule of this forum. In fact, it is in violation of the forum rules.
## Post #7
- Username: Fiel
- Rank: advanced
- Number of posts: 46
- Joined date: Mon Dec 17, 2007 1:29 am
- Post datetime: 2011-08-01T15:51:45+00:00
- Post Title: Rusty hearts .pck

> Reply from chrrox
>
> No online game has ever been broken by modifing the client files directly.
The thing that breaks games are realtime memory modding programs like cheat engine.
I really hope you change your mind on releasing the info.

You've obviously never played Maplestory. The game was hacked to hell due to file editing.

> Reply from Mr.Mouse
>
> What's the use of coming in here and not sharing information? 

"Look, I cracked it, but I'm not going to share...tough luck on you all" is basically what you're saying. That is not the rule of this forum. In fact, it is in violation of the forum rules.

No, that's not what I'm saying at all. I did share some of my information.

1. I 100% confirmed that f00X.dat contains the file directory.
2. There are two layers of encryption.
3. It requires a debugger to crack because the encryption is unguessable.
4. I even shared a picture of the sample output and what it should look like.

It does not say in the forum rules that if I can fully crack it that I need to share all of my cards. I did give out some very useful info that I would have loved to have when I first started.
## Post #8
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-08-01T16:05:52+00:00
- Post Title: Rusty hearts .pck

...so you are not going to share the full details?
## Post #9
- Username: Fiel
- Rank: advanced
- Number of posts: 46
- Joined date: Mon Dec 17, 2007 1:29 am
- Post datetime: 2011-08-01T16:23:42+00:00
- Post Title: Rusty hearts .pck

> Reply from Mr.Mouse
>
> ...so you are not going to share the full details?

I apologize if I've offended you or the purpose of this forum or have broken forum rules. That was not my intent. I figured that some help was better than no help at all so that's why I posted. My intent was not to brag, but to share some information.

No, I will not be sharing the full details.
## Post #10
- Username: chrrox
- Rank: Moderator
- Number of posts: 2602
- Joined date: Sun May 18, 2008 10:01 pm
- Post datetime: 2011-08-01T20:52:43+00:00
- Post Title: Rusty hearts .pck

you mentioned maple story was ruined from file modding i don't think that is the case.
If you google maple story hacking there are about 100,000 results for guides on using cheat engine to do this which does not touch the client files.
Also posting a compiled exe to extract the game would not hurt anything.
And if you are afraid someone would try to reverse it and then the game would be ruined well they could just hack the game itself anyway.
## Post #11
- Username: finale00
- Rank: M-M-M-Monster veteran
- Number of posts: 2382
- Joined date: Sat Apr 09, 2011 8:22 am
- Post datetime: 2011-08-02T01:57:16+00:00
- Post Title: Rusty hearts .pck

Ya, if it's that hard to actually get the files, I can't imagine how hard it would be to put it back in the game
## Post #12
- Username: Darkfox
- Rank: VVIP member
- Number of posts: 688
- Joined date: Sat Jul 05, 2003 1:11 am
- Post datetime: 2011-08-02T08:44:42+00:00
- Post Title: Rusty hearts .pck

Technically, most file hacks like that would be client-side only or be sniffed/blocked out easily, and 98% of all online hacking is performed with memory hacking programs that have no connection with file editing but rather editing values in memory (like gameshark). The only way file cracking could work in most cases these days is if the hacker also has a cracked server, this may be impossible unless the MMO in question allows that, and in THAT case it would only be on THAT server. Thus hacking in this manner would be more trouble than it is worth. The biggest things groups tend to fear is not this, but stealing their resources and making money off of it but even these are easy to thwart these days so it is hardly an issue either.

All-in-all, unless tested to be true that it would work outside the client, this may not be a legitimate worry.

I know this from experience, though not cheat hacking, just a lot of just-for-fun stuff to get laughs. The server itself would have to be cracked usually and administrative commands or hacks would need to be called from it to enact desired changes. As said though, requires people to actually join the server and etc. Client-side just would affect their side and would likely get them all glitched up or just banned so that would be useless. Added there may be an online integrity checker that could null this easier anyways. Anyways, just rambling on here now, but all-in-all I'm saying that what your worried about is technically inconceivable without a hacked server.

Maybe it works differently in this case, but I doubt it as pretty much all online games I've modded worked this way.

As chrrox said, it is mostly cheat engines that seem to use exploits in the system than modify local files anyways.

Edit: However, grateful that you have given info. Some tend to recoil and give nothing even if it is a game that few outside a cult play anymore anyways, I find it also a fatal blow to a game to fully deter modding, though I'm referring to non-MMO games here.

Also: Doe anyone else think that looks exactly like a feminized Kratos from Tales of Symphonia?
## Post #13
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-08-02T10:13:29+00:00
- Post Title: Rusty hearts .pck

So I think we are in agreement that there is no legitimate reason to withhold the information, other than a desire to be the only one to have the information, and thereby making life unnecessarily hard on others.

This rule states how we look at matters like these:

> 9. It is forbidden to complain about how a modding tool or method that's in development will "destroy" your game community.
>
> You are wrong, history has proven you wrong, and we will always side with the developers of those tools.

The subsection of rule 4 reads:

> That is the mission here. SHARE your knowledge! We are all in it together!
## Post #14
- Username: Think
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Mon Feb 14, 2011 8:29 pm
- Post datetime: 2011-08-02T12:05:36+00:00
- Post Title: Rusty hearts .pck

I've been a long time reader of this board and it helped me several times in gaining access to game archives. I was happy when I found there had been activity on this game, because I wanted to get some background music from the archive.

I find it weird that someone comes here just to tell everyone that he did it, but refuses to share anything that would help in reproducing it. I don't know the exact way these archives are extracted but normally, extracting and importing from game archives are two different things that are not necessarily reversable (and easily detectable in an online game).

I therefore strongly support this request:

> Also posting a compiled exe to extract the game would not hurt anything.
## Post #15
- Username: finale00
- Rank: M-M-M-Monster veteran
- Number of posts: 2382
- Joined date: Sat Apr 09, 2011 8:22 am
- Post datetime: 2011-08-02T13:04:51+00:00
- Post Title: Rusty hearts .pck

Well, if someone else figures out how to do it, then he'll get the thanks for choosing to release information that he worked for on his own without any help 

Though really I'd rather have people going ahead and working with the rest of the files already rather than having everyone figure it out themselves for the sake of educational purposes.

Just because the files have been unpacked, doesn't mean we know anything about them.
There are still plenty of outstanding model formats that still haven't been figured out (completely) despite floating around for years.

EDIT: I went and searched for extractors and someone on the official forums "already figured it out" and "knows what he's talking about cause he's a software engineer" but "isn't going to post it cause it's his work"  lol
## Post #16
- Username: chrrox
- Rank: Moderator
- Number of posts: 2602
- Joined date: Sun May 18, 2008 10:01 pm
- Post datetime: 2011-08-03T00:17:06+00:00
- Post Title: Re: Rusty hearts .pck

yeah this guy just seems like a troll.
Just ignore him someone will crack the format and post it at some point.
Most of the people i know who can do this are very busy right now but it will happen it will just take longer till they get some time.
## Post #17
- Username: chrrox
- Rank: Moderator
- Number of posts: 2602
- Joined date: Sun May 18, 2008 10:01 pm
- Post datetime: 2011-08-06T21:33:21+00:00
- Post Title: Re: Rusty hearts .pck

Extractor with full source code is released on ragezone [http://forum.ragezone.com/f111/rusty-he ... ndex2.html](http://forum.ragezone.com/f111/rusty-hearts-768135/index2.html)


I have now doomed this game into oblivion forever or....
the models can be extracted and the music listened to.
only time will tell.
## Post #18
- Username: finale00
- Rank: M-M-M-Monster veteran
- Number of posts: 2382
- Joined date: Sat Apr 09, 2011 8:22 am
- Post datetime: 2011-08-06T21:59:06+00:00
- Post Title: Re: Rusty hearts .pck

ragezone is always reliable 

Now to figure out how to destroy the game. Anyone have any idea what I can do with custom models that only I can see?
## Post #19
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-08-09T07:44:47+00:00
- Post Title: Re: Rusty hearts .pck

> Reply from chrrox
>
> Extractor with full source code is released on ragezone http://forum.ragezone.com/f111/rusty-he ... ndex2.html


I have now doomed this game into oblivion forever or....
the models can be extracted and the music listened to.
only time will tell.

Would you please upload the stuff here as well?
## Post #20
- Username: chrrox
- Rank: Moderator
- Number of posts: 2602
- Joined date: Sun May 18, 2008 10:01 pm
- Post datetime: 2011-08-09T09:07:27+00:00
- Post Title: Re: Rusty hearts .pck

yeah sure i don't know why that guy said there were 2 encrypt ions it was just xored with a compressed header.
[RustyHeartsExtractor.zip](https://xentaxbackup.github.io/file/4599_RustyHeartsExtractor.zip)
## Post #21
- Username: Fiel
- Rank: advanced
- Number of posts: 46
- Joined date: Mon Dec 17, 2007 1:29 am
- Post datetime: 2011-08-09T18:57:44+00:00
- Post Title: Re: Rusty hearts .pck

I'm not a troll. And he didn't break it fully because he didn't look at the rh files which are also encrypted. I told you guys there were two encryptions and he only got one of them.

RUSTY HEARTS GAME PROTECTION:

The game protection on this game is weak:
- MPatcher.exe contains the keys to decrypt f00X.dat, and this program doesn't have any PE packing. Just hook up a debugger and watch it unpack the MIP files that it receives while patching to figure out how to do f00X.dat. 
- The CRC table is also available from MPatcher.exe.
- XTrap can be seen from the Task Manager and Process Explorer.
- IDA Pro can continue to run while XTrap is running
- No PE Protection on RustyHearts.exe
- Very non-random AES key.
- The AESIV used for decryption is located right next to the Rijndael SBox in the executable which makes it very easy to find.
- The AES cipher uses the ECB mode of operation. This mode of operation is insecure because similar blocks are encrypted in the same way which can lead to a plaintext attack. They should use CBC or OFB instead.

I would strongly encourage the development team at Perfect World Entertainment to beef up their security.

RUSTY HEARTS UNPACKING:

All of the files which I refer to are available in the ZIP file in this post.

The file directory is stored in f00X.dat. The encryption on f00x.dat is an extremely simple static stream cipher. The stream cipher is attached in the file called "RustyHearts.keys".

There is a crc32 also implemented to check file integrity. Although I have not included the calculation in the python scripts attached, I have included the CRC Table in "RustyHearts.crc".

Once you've decrypted f00X.dat by XORing it with the RustyHearts.keys, decompress it with zlib. Then you can fetch the directoryTree:

```
{
   fileName (Widechar pascal string)
	packFileNumber (byte)
	fileLength (int32)
	fileChecksum (int32)
	fileOffset (int32)
	nulls (int32)
}
```


Now that you have the directory tree, simply open up the PCK file represented by directoryTreeFile.packFileNumber, seek to the directoryTreeFile.fileOffset, and then read directoryTreeFile.fileLength bytes and write out to the file given by directoryTreeFile.fileName.

WARNING: There are some fileNames which are in asian languages. This may not play nicely with English on Windows 7. It didn't for me!

After you get the files unpacked, then you'll want to unpack the Rusty Hearts tables (located in "/table/" with suffix ".rh"). These are encrypted with AES-256.

AESKey = gkw3iurpamv;kj20984;asdkfjat1af\0
AESIV = 0xDB0F4940
AESMode = ECB

For the AESKey, that's 31 characters followed by a null terminator. The null terminator is required for the AES cipher to function. Decrypt the ".rh" files.

Also, it turns out that the developers of Perfect World Entertainment have a sense of humor. The AESIV when read as a Float32 represents 3.141593.

The tables are fairly simple:

```
{
	numRows (int32)
	numColumns (int32)
	columnNames (array of widechar pascal strings)
	columnTypes (array of int32)
	rowData
}
```


```
{
	int32,
	float32,
	string = 3,
	int64
}
```


I haven't found anywhere that uses a columnType of 2.

From this point in the file, it's just a matter of reading all of the row data which should be extremely straightforward.

For the unpacker, you will need the following:

Python 2.6 ([http://www.python.org](http://www.python.org))
NumPy ([http://numpy.scipy.org/](http://numpy.scipy.org/))
PyCrypto ([http://www.voidspace.org.uk/python/modu ... l#pycrypto](http://www.voidspace.org.uk/python/modules.shtml#pycrypto))

There is a hash that's used in Service.dat. That would be SHA-1. I don't know what it's hashing at the moment.
[RustyHearts.7z](https://xentaxbackup.github.io/file/4601_RustyHearts.7z)
## Post #22
- Username: Mr.Mouse
- Rank: Site Admin
- Number of posts: 4073
- Joined date: Thu Jan 16, 2003 1:45 am
- Post datetime: 2011-08-10T09:17:16+00:00
- Post Title: Re: Rusty hearts .pck

Thanks to Chrrox and Fiel for the information!
