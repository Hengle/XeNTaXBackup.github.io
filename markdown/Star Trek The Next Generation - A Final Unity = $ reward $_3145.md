## Post #1
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2008-09-03T17:24:05+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Cash reward offered to anyone who can help me!
==============================

I'm hoping that someone can add support for some (more) Star Trek games to MultiEx. I own probably every popular Star Trek game that has been released since the early 1990s, and would love to be able to export files from these games' archives for use for various Star Trek-related modifications, websites, and of course for my own sense of nosiness! 

I can provide people with files from any Star Trek game on request, but I was hoping to start my fun with one of the best Star Trek games from the mid 1990s - Star Trek: The Next Generation - A Final Unity. Most of the files are useless to modern requirements (such as the textures for models, and sprites, however the sound/audio/speech files are of great importance and usefulness for me and many other people in various modding communities. 

I have so far been unable to open the '.vac' files that (as far as I can tell) hold the data for the audio/speech files that populate the game with hours of audio recorded by the real Star Trek: The Next Generation cast.

I am so eager to be able to access/convert these files, that I would like to offer a cash incentive to anyone who has the specialist skills or knowledge to be able to make these files accessible to me (as well as donating to the developers of MultiEx, obviously ). If anyone thinks that they can manage to generate MultiEx support for the sound files (see the attached Archive.zip which includes a small random selection of .vac files from the game's CD), please let me know - I'd love to discuss terms!
[Archive.zip](https://xentaxbackup.github.io/file/1631_Archive.zip)
## Post #2
- Username: Zench
- Rank: VIP member
- Number of posts: 209
- Joined date: Mon May 05, 2008 4:11 am
- Post datetime: 2008-09-05T00:24:43+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

It looks to me like this is just raw compressed audio with little or no header. The codec seems to be a relatively simple ADPCM method, but I don't know which one. That's just my quick look at those files.
## Post #3
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2008-09-05T02:32:14+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Thank you very much for your reply. 

As I am a complete novice when it comes to programming and file formats, what you have told me won't be enough to enable me to get these files readable/playable/convertable. While I understand the basics of header files and codecs, I don't have the skill to take the next step.

Can anyone else help?
## Post #4
- Username: Zench
- Rank: VIP member
- Number of posts: 209
- Joined date: Mon May 05, 2008 4:11 am
- Post datetime: 2008-09-06T21:57:54+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Here is what I have so far: could you tell me if they are decoded correctly? I don't think it's perfect, but I just want your opinion.
[StarTrekVACDecoded.zip](https://xentaxbackup.github.io/file/1632_StarTrekVACDecoded.zip)
## Post #5
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2008-09-07T17:55:14+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Wow, this is so great! They're not 100% clear at the point, although I am very impressed - thank you so much. Can they be refined further?

Do you need anything else in order to continue? More files, or information?
## Post #6
- Username: Zench
- Rank: VIP member
- Number of posts: 209
- Joined date: Mon May 05, 2008 4:11 am
- Post datetime: 2008-09-09T01:50:59+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Here is a small program I created to decode the files (as above), so you can do some experimentation yourself. It should be self-explanatory. It's really quite a hack so there isn't any way to improve the quality of this program (since I didn't write part of it, and neither do I have the source code). But there are a few other things that I would like to try.

> Reply from Broken Alien
>
> Do you need anything else in order to continue? More files, or information?I think I'll send you a PM.
[DecVacTest.zip](https://xentaxbackup.github.io/file/1635_DecVacTest.zip)
## Post #7
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2008-09-09T02:01:36+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Thank you so much for your help thus far! I will await your PM.
## Post #8
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2009-07-19T02:25:15+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Hello all,

While user Zench was supremely helpful in his investigations last year, he unfortunately couldn't help me decode the files in this game to the point of clarity. As I'm beginning to require the use of the voice/sound files from this game in other projects, the time has come for me to offer a real cash incentive for any of you wonderfully smart programmers who can help me. I'd like to offer $100 to anyone who can help me achieve the goal of successfully decoding the files from this game in their original clarity.

As I said in my original post in this topic, I can provide any and all files from the game, and can work with you over email, Skype, MSN, or any popular messaging application to get effectively carry out this project, as it is of major personal importance to me. 

A quick recap of the situation: The game, Star Trek: The Next Generation - A Final Unity is a 1994/1995 DOS-based game which still holds its ground today as being one of the few Star Trek games that was 'done right'. It was epic in its story, and equally as epic in its amount of voice acting that went into the game. All the seven stars from the television show provided seemingly hours of audio throughout the game, and up until now it's an untapped resource that would be of major importance for Star Trek modders of any gaming engine/platform/game. It's a gold-mine of a resource, and I hope you can help me tap into it!
## Post #9
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-02-27T13:57:39+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Another 'bump' (I hope that's allowed!) to ask if anyone has time to take a look at this problem...
## Post #10
- Username: hcs
- Rank: mega-veteran
- Number of posts: 263
- Joined date: Mon Oct 19, 2009 4:41 am
- Post datetime: 2010-02-27T22:18:39+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Unless I'm greatly mistaken, this is just IMA. You can convert it with sox:

```
sox -N -r 22050 -t ima 0208011d.vac out.wav
```

Doesn't sound 100%, but certainly better than the Dialogic Vox interpretation.

[edit] Ah, as I'd thought, they expect the bad rounding used in the reference implementation.  I'd made a modified build of sox for this: [sox-14.3.0-ima-mod0](http://hcs64.com/files/sox-14.3.0-ima-mod0.zip), that should work slightly better than normal sox on these files.

[edit2] still a small DC offset... bah, but at least smaller.  I assume it's some slightly different rounding arrangement.  In any case it doesn't go out of range, this may be as close as I can get without disassembling the executable.

[edit3] looking at some of these I'm not so sure that the DC offset is an error of the decoder... take a look at feff1333.vac converted, the offset kicks in right at the start, and is the same by the end, whereas a rounding error wouldn't be apparent at all at the beginning, only accumulating by the end.  There may just be an offset in the original signal.

[edit4] Though note that you should still use my sox build, there are definitely rounding errors accumulating in the default IMA decoder.
## Post #11
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-03T19:06:22+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Wow, the results from your Sox build are fantastic! I never thought this would be possible to achieve - I can't thank you enough!

Would you be kind enough to help me a little more?:

1) Could you explain (in terms that a novice would understand..!) about the 'DC offset' and the rounding error? I don't understand what you mean by it. If you felt that you could and would get a better result by 'disassembling the executable', then by all means please let me know and I'll arrange for you to access it (and of course reward you for your extra time). [Or is the Sox build that you modified giving us the best results that we're going to be able to achieve?]

2) Can you tell me how to batch-run Sox on, say all *.vac files in a folder and have their original filenames remain intact...so just batch-convert all the files in one go? (This is definitely a 'newbie' question, but command line tools scare me at the best of times)!

Again, thank you so much!
## Post #12
- Username: hcs
- Rank: mega-veteran
- Number of posts: 263
- Joined date: Mon Oct 19, 2009 4:41 am
- Post datetime: 2010-03-04T01:25:14+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

1) I'm not exactly an audio pro myself, the basic idea of the DC offset is that sound is supposed to be an AC signal centered on zero.  The intensity of the sound (an analog of the pressure from the sound wave) is represented by a time series of samples about zero, zero being neutral and positive and negative being a displacement either way.  The signal should in the long run be about as often above zero as below it.  Otherwise it indicates some long running pressure, or more likely an electrical problem when recording.  This is going to be filtered out by any number of things, but it can cause distortion, particularly if it gets large enough that the wave starts clipping (running up against the maximum range of the signal).

The only reason this is bothering me is that there is another explanation for a DC offset at the end of a track (where it is easiest to notice on most of these).  The specification for IMA ADPCM provides a reference algorithm, which pulls apart a single addition and multiplication into several fixed shifts and additions, ostensibly for speed.  However this results in more truncation (that is, round by throwing away fractional parts, as integer division is used) than a straightforward implementation of the equation.  Both variants are in widespread use.  Normally it doesn't matter; the IMA encoder includes the decoder, and as long as the decoder is the same everything works out fine.  However a slightly different decoder will do the rounding differently (more or less truncation, in different parts of the process), and an error will accumulate as a DC offset.  This will be negligible at the beginning of the sound, but may be fairly large by the end.  (Technically this means it isn't really a DC offset, as it's changing, but it has the same effects).  So I replaced sox's IMA decoder with one that rounds like the reference algorithm.  I think it is clearly more accurate, but I'm not sure that it is 100% correct.

In the case of feff1333.vac, if you look at the converted waves in a sound editor, you'll see that the sound starts of perfectly on zero, then it jumps sharply down a bit before waving off like normal.  Here's some snapshots to show it.

beginning of feff1333.vac

end of feff1333.vac


Note that under the modified IMA decoder (bottom) the offset at the end is essentially the same size as the jump at the beginning (where the DC offset kicks in, I don't know where the true silence comes from), whereas with the original decoder (top) is a lot further off.

Regarding disassembling the executable, I'd be up for it.  It'd let me determine exactly the right method.  IMA decoders aren't hard to analyze, they have a common table that'll be easy to spot.

I should point out now that the offsets we're seeing are most likely from the original sound, and they're far too small to have any audible effect.  I'm just a perfectionist.

2) Run:

```
for %a in (*.vac) do sox.exe -D -N -r 22050 -t ima %a -s %a.wav
```
A few more options thrown in this time.  -D disables dithering, -s makes the output signed PCM (16-bit, normal CD resolution) so sox doesn't go reencoding it to MS IMA ADPCM (as it was before).  Both are optional, up to you what you'd prefer.
## Post #13
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-04T02:08:33+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Thanks for that great post! I'm really pleased that you took the time to explain it all.

You can find (what I think are) the executables for the game here: [http://public.me.com/robert.goacher](http://public.me.com/robert.goacher) 

If you need me to upload the entire ISO, let me know and I'll get around to it.

I can't seem to get SoX to run using that command-line. I copied the SoX files into the directory with the .vac files. I'm using Windows 7, and I'm hitting START+R to open the 'Run' dialogue, then running the following:

"F:\Games\Star Trek - The Next Generation - A Final Unity\Extract\STTNG\sound converting\sox.exe" for %a in (*.vac) do sox.exe -D -N -r 22050 -t ima %a -s %a.wav

But the window just opens and closes immediately. What am I doing wrong?
## Post #14
- Username: Broken Alien
- Rank: Moderator
- Number of posts: 652
- Joined date: Thu Oct 19, 2006 4:48 am
- Post datetime: 2010-03-04T02:51:49+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

Open a commandbox with "cmd" and then enter your command so you can see the error message.
## Post #15
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-04T02:56:56+00:00
- Post Title: Star Trek: The Next Generation - A Final Unity = $ reward $

C:\Users\Bob>"C:\Users\Bob\Desktop\sound_converting\sox.exe" for %a in (*.vac) d
o sox.exe -D -N -r 22050 -t ima %a -s %a.wav
C:\Users\Bob\Desktop\sound_converting\sox.exe FAIL formats: can't open input fil
e `%a': No such file or directory

(I moved the directory and removed the spaces from the path just in case that was the problem, but I still get that error).
## Post #16
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-04T03:45:51+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Okay, after doing some researching and head-scratching, I changed %a to %%a and it worked. 

My files are now converted - it's truly wonderful to be able to play these all back! They're a little echoey, however - is there anything that can be done about that?

A further problem has unfortunately arisen. Many of the files appear to end abruptly, and I can't work out why. I have attached a ZIP archive of a file that illustrates what's happening. I would upload more here directly, but apparently I can only have one attachment per post, and the maximum upload is 250KB! Very limiting.

If you want more, I've upload a ZIP of four files here: [http://public.me.com/robert.goacher](http://public.me.com/robert.goacher) (shortened.zip).
[fe030001.zip](https://xentaxbackup.github.io/file/2834_fe030001.zip)
## Post #17
- Username: hcs
- Rank: mega-veteran
- Number of posts: 263
- Joined date: Mon Oct 19, 2009 4:41 am
- Post datetime: 2010-03-04T05:53:20+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Those wavs all sound complete to me.  Do these files not sound echo-y in-game?  There may be another layer of filtering that takes that out, possibly.
The weird thing is, I picked up the game from your directory, and I'm looking at the decoder: it appears to do the decoding the right way, with less roundoff, the way sox does it by default.  So I'm a bit uncertain which of the two to prefer, and why changing it seemed to clean up at least that one file so well.
## Post #18
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-04T11:10:24+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Thanks again for your reply.

1) In Windows Media Player, they sound fine. I was using VLC (as its my preferred media player when I'm using my Mac) but it was definitely cutting off the ends of the sounds. How very odd!

2) Only SOME of the files are echoey. It's possible that this is intentional, as from the 10,000+ files in the directory, I definitely recognise the echoey files as being clips from 'away missions' in the game - off-ship environments. Are there are any audio filters that can remoe echoes from files? I had a quick look at Audacity but I couldn't find what I wanted.

Thank you again. I feel that I'm very close to having all the answers now.
## Post #19
- Username: hcs
- Rank: mega-veteran
- Number of posts: 263
- Joined date: Mon Oct 19, 2009 4:41 am
- Post datetime: 2010-03-04T11:45:47+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Could you indicate a particular file that is echoey?  I don't know of a handy way to remove echo, but if it's a decoding artifact I might be able to do something about it.  It seems likely that this is just how the audio is supposed to be, though, all the files I checked sound fine.  Have you compared how they sound decoded to how they sound in-game?
## Post #20
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-04T11:56:27+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

[http://public.me.com/robert.goacher](http://public.me.com/robert.goacher) - see "echo.wav".

As you'll hear, it is somewhat echoey. Definitely not as crisp as some of the other sounds. 

I hope that example is good enough. It might be a bit tough for me to find a specific file's occurrence during the game. There are over 10,000 sound files, all with seemingly random names - to choose one and then guess where it appears in the game, then playing to that location, then hoping that I've chosen the correct sequence of previous actions to ensure that the voice clip is player, will take some time! I hope that just uploading the file for you will be good enough.
## Post #21
- Username: hcs
- Rank: mega-veteran
- Number of posts: 263
- Joined date: Mon Oct 19, 2009 4:41 am
- Post datetime: 2010-03-04T15:51:25+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Ok, I had assumed you'd played through the game and could recognize some of the clips.  I think the echo (in this echo.wav) is just a part of the sound.  There are probably techniques to remove that, but I'd just be searching at random.
## Post #22
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-04T16:05:46+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Well I recognise the sounds, but the game allows you to choose what to say, so sometimes a certain combination of previous choices is required for a particular voice clip to play... so yeah it could take a while to pinpoint it in-game!

I think we're done. The files are extracted and playable, and I have access to this wonderful resource. Please PM me with how I may reward you.

Thank you so much for your input!
## Post #23
- Username: DK
- Rank: ultra-n00b
- Number of posts: 4
- Joined date: Mon Jul 04, 2005 3:54 pm
- Post datetime: 2010-03-08T07:20:05+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Hi, I'm a fan of Star Trek and I've this game; avery beautiful game!
So, I'm curious about the sound format (I like extract music and sounds effects from games  ), and I've made some research; unfortunately I'm very busy lately, and all I have found is that, maybe, the sound format is a:
RAC IMA-ADPCM
as indicated in the description of the [foo_adpcm](http://kode54.foobar2000.org/?v) this plugin for [Foobar2000 player](http://www.foobar2000.org/) that should play this kind of file.
I've made a quick test, but seems do not recognize the file; if someone have more time maybe can investigate better than me.
## Post #24
- Username: hcs
- Rank: mega-veteran
- Number of posts: 263
- Joined date: Mon Oct 19, 2009 4:41 am
- Post datetime: 2010-03-08T08:31:29+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Thanks for pointing that out, DK.  I talked to kode54, the author of foo_adpcm, and he pointed out that there are in fact two wrong ways to do the rounding, and I was using one of them.  I had thought it was equivalent but apparently didn't do enough testing.

Anyway here's another modified build of sox that does IMA in the "strict" manner (which apparently sox itself used to use back in 2004 or so), and it now works perfectly, everything's nice and AC.
[http://hcs64.com/files/sox-14.3.0-ima-mod1.zip](http://hcs64.com/files/sox-14.3.0-ima-mod1.zip)

There's still the puzzle of why the game itself doesn't have a decoder that works like this, but at least this matches nicely with the encoder.
## Post #25
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-08T14:17:32+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Will this give better results than your previous build?
## Post #26
- Username: hcs
- Rank: mega-veteran
- Number of posts: 263
- Joined date: Mon Oct 19, 2009 4:41 am
- Post datetime: 2010-03-08T15:23:50+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

I very much doubt you'll be able to hear a difference, but it is more correct.
## Post #27
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2010-03-08T15:29:02+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Okay, thanks. 

I'd already extracted and began sorting through the 10,000 audio files, so I'd hate to have been given a reason to start over!
## Post #28
- Username: delphoid
- Rank: ultra-n00b
- Number of posts: 2
- Joined date: Sat Jan 08, 2011 11:42 pm
- Post datetime: 2011-01-08T15:52:21+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

I'm currently in the process of building a TNG adventure game (in the spirit of old-style sierra point-and-click adventure games like Kings Quest and Space Quest).  I'd LOVE to get my hands on the audio files you were able to extract from Final Unity.  Are they hosted online anywhere?  If so please post the URL so everyone can benefit from this incredible effort!

Thanks!!

ian
## Post #29
- Username: Broken Alien
- Rank: n00b
- Number of posts: 17
- Joined date: Wed Sep 03, 2008 11:27 pm
- Post datetime: 2011-01-08T17:25:01+00:00
- Post Title: Re: Star Trek: The Next Generation - A Final Unity = $ reward $

Hi Ian,

I'm in the process of sorting, labelling, and naming the files. There are thousands...so it's taking a while!

When I finish, I shall host a repository of Star Trek voice files, for all to access.

I'd like to know more about your project though - please email me! 

[robert.goacher@me.com](mailto:robert.goacher@me.com)
